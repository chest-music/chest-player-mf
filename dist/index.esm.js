import e,{useState as t,useEffect as r,useCallback as n,useRef as a}from"react";import{motion as l}from"framer-motion";import{useDispatch as o,useSelector as i}from"react-redux";import c from"wavesurfer.js";import{ClockIcon as u,SpeakerXMarkIcon as s,SpeakerWaveIcon as m,ChevronDownIcon as f}from"@heroicons/react/24/outline";function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t,r,n,a,l,o){try{var i=e[l](o),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function v(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},y.apply(null,arguments)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){v(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function E(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function w(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function l(r,n,a,l){var c=n&&n.prototype instanceof i?n:i,u=Object.create(c.prototype);return b(u,"_invoke",function(r,n,a){var l,i,c,u=0,s=a||[],m=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return l=t,i=0,c=e,f.n=r,o}};function p(r,n){for(i=r,c=n,t=0;!m&&u&&!a&&t<s.length;t++){var a,l=s[t],p=f.p,d=l[2];r>3?(a=d===n)&&(c=l[(i=l[4])?5:(i=3,3)],l[4]=l[5]=e):l[0]<=p&&((a=r<2&&p<l[1])?(i=0,f.v=n,f.n=l[1]):p<d&&(a=r<3||l[0]>n||n>d)&&(l[4]=r,l[5]=n,f.n=d,i=0))}if(a||r>1)return o;throw m=!0,n}return function(a,s,d){if(u>1)throw TypeError("Generator is already running");for(m&&1===s&&p(s,d),i=s,c=d;(t=i<2?e:c)||!m;){l||(i?i<3?(i>1&&(f.n=-1),p(i,c)):f.n=c:f.v=c);try{if(u=2,l){if(i||(a="next"),t=l[a]){if(!(t=t.call(l,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=l.return)&&t.call(l),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);l=e}else if((t=(m=f.n<0)?c:r.call(n,f))!==o)break}catch(t){l=e,i=1,c=t}finally{u=1}}return{value:t,done:m}}}(r,a,l),!0),u}var o={};function i(){}function c(){}function u(){}t=Object.getPrototypeOf;var s=[][n]?t(t([][n]())):(b(t={},n,function(){return this}),t),m=u.prototype=i.prototype=Object.create(s);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,b(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return c.prototype=u,b(m,"constructor",u),b(u,"constructor",c),c.displayName="GeneratorFunction",b(u,a,"GeneratorFunction"),b(m),b(m,a,"Generator"),b(m,n,function(){return this}),b(m,"toString",function(){return"[object Generator]"}),(w=function(){return{w:l,m:f}})()}function b(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}b=function(e,t,r,n){if(t)a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{function l(t,r){b(e,t,function(e){return this._invoke(t,r,e)})}l("next",0),l("throw",1),l("return",2)}},b(e,t,r,n)}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,l,o,i=[],c=!0,u=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}var P=function(e){var n=x(t(!1),2),a=n[0],l=n[1];return r(function(){var t=window.matchMedia(e);t.matches!==a&&l(t.matches);var r=function(){return l(t.matches)};return window.addEventListener("resize",r),function(){return window.removeEventListener("resize",r)}},[a,e]),a};function N(e){var t,r=o(),a="undefined"!=typeof window&&null!==(t=window.__CHEST_PLAYER_DEPS__)&&void 0!==t&&t.modalActions?window.__CHEST_PLAYER_DEPS__.modalActions:{openModal:function(){},closeModal:function(){},isModalOpen:function(){return!1}},l=a.openModal,c=a.closeModal,u=a.isModalOpen,s=n(function(t){return r(l(e,t))},[r,l,e]),m=n(function(){return r(c(e))},[r,c,e]);return{isOpen:i(function(t){return u(t,e)}),onOpen:s,onClose:m}}function k(e){return Object.keys(e).map(function(t){return!0===e[t]?t:""}).join(" ")}var j=function(e){if(!e)return"0:00";"string"==typeof e&&(e=parseInt(e));var t=Math.floor(e/60),r=Math.floor(e%60),n=r<10?"0".concat(r):r;return"".concat(t,":").concat(n)};function S(t){var r,n=t.timeProgress,a=t.duration,l=t.progressBarRef,o=t.audioRef;t.open;var i=!(null===(r=t.playlist[0])||void 0===r||!r.token);return e.createElement(e.Fragment,null,e.createElement("div",{className:"w-full flex items-center gap-1.5 player-progressbar"},e.createElement("div",{className:"text-sm"},j(n)),e.createElement("input",{type:"range",defaultValue:0,step:.05,className:"bg-neutral-black rounded-lg h-1.5 appearance-none ".concat(i?"pointer-events-none":""),ref:l,onChange:function(){i||(o.current.currentTime=l.current.value)}}),e.createElement("div",{className:"text-sm"},j(a))))}function C(t){var r,n=t.timeProgress,a=t.duration,l=t.progressBarRef,o=t.audioRef,i=t.open,c=!(null===(r=t.playlist[0])||void 0===r||!r.token);return e.createElement(e.Fragment,null,e.createElement("div",{className:k({"w-full flex items-center player-progressbar":!0,"flex-col gap-2":i,"gap-1.5":!i})},i&&e.createElement("div",{className:"grid grid-cols-2 w-full"},e.createElement("div",{className:"text-sm"},j(n)),e.createElement("div",{className:"text-sm text-right text-neutral-silver-200"},j(a))),e.createElement("input",{type:"range",defaultValue:0,step:.05,className:k({"bg-neutral-black rounded-lg appearance-none":!0,"h-1.5":i,"h-[3px]":!i,"pointer-events-none":c}),ref:l,onChange:function(){c||(o.current.currentTime=l.current.value)}})))}function A(n){var l,o=n.timeProgress,i=n.duration,u=n.audioRef;n.open;var s=n.playlist,m=n.currentTrack,f=a(null),p=a(null),d=x(t(!1),2),v=d[0],y=d[1],g=!(null===(l=s[0])||void 0===l||!l.token);r(function(){if(f.current&&null!=m&&m.url){try{p.current=c.create({container:f.current,waveColor:"#6B7280",progressColor:"#D4AF37",cursorColor:"#D4AF37",height:24,normalize:!0,backend:"WebAudio",barWidth:2,barGap:1,barRadius:2,interact:!g,hideScrollbar:!0,fillParent:!0}),null!=m&&m.url&&p.current.load(m.url),p.current.on("ready",function(){y(!0)}),p.current.on("seek",function(e){if(!g&&u.current){var t=e*i;u.current.currentTime=t}}),p.current.on("click",function(e){if(!g&&u.current){var t=e*i;u.current.currentTime=t}})}catch(e){console.error("Error creating WaveSurfer:",e),y(!1)}return function(){if(p.current)try{p.current.destroy()}catch(e){console.error("Error destroying WaveSurfer:",e)}}}},[null==m?void 0:m.url,g]),r(function(){if(p.current&&v&&i>0){var e=o/i;p.current.seekTo(e)}},[o,i,v]);var h={opacity:v?1:.5,transition:"opacity 0.3s ease",cursor:g?"default":"pointer"};return v||null!==p.current?e.createElement("div",{className:"w-full flex items-center gap-1.5 player-progressbar"},e.createElement("div",{className:"text-sm"},j(o)),e.createElement("div",{ref:f,className:"flex-1 h-6 rounded-lg overflow-hidden bg-neutral-black",style:h}),e.createElement("div",{className:"text-sm"},j(i))):e.createElement("div",{className:"w-full flex items-center gap-1.5 player-progressbar"},e.createElement("div",{className:"text-sm"},j(o)),e.createElement("div",{className:"flex-1 h-6 rounded-lg bg-neutral-black flex items-center justify-center"},e.createElement("span",{className:"text-xs text-neutral-silver-300"},"Loading waveform...")),e.createElement("div",{className:"text-sm"},j(i)))}var O=["styles"],T=function(t){t.styles;var r=E(t,O);return e.createElement("svg",y({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M1.668 10.001a5.776 5.776 0 011.634-4.028 5.513 5.513 0 013.936-1.672h7.255l-.257-.262a.902.902 0 01-.258-.637.92.92 0 01.258-.638.88.88 0 01.623-.264.863.863 0 01.623.264l1.759 1.8a.901.901 0 01.258.637.918.918 0 01-.258.638l-1.76 1.8a.876.876 0 01-1.245 0A.901.901 0 0113.977 7a.918.918 0 01.26-.637l.256-.263H7.238c-1.011 0-1.98.411-2.695 1.143A3.947 3.947 0 003.427 10a.91.91 0 01-.258.637.87.87 0 01-1.243 0A.91.91 0 011.668 10zm14.95-.9a.87.87 0 00-.622.264.91.91 0 00-.258.636 3.98 3.98 0 01-.29 1.493 3.907 3.907 0 01-.826 1.265c-.354.362-.774.65-1.236.845a3.735 3.735 0 01-1.458.297H4.673l.256-.262a.912.912 0 000-1.275.87.87 0 00-1.246 0l-1.758 1.8a.902.902 0 00-.259.637.918.918 0 00.259.637l1.758 1.8a.877.877 0 001.246 0 .901.901 0 00.259-.637.918.918 0 00-.259-.638l-.256-.262h7.255a5.513 5.513 0 003.936-1.672 5.776 5.776 0 001.633-4.028.91.91 0 00-.257-.636.87.87 0 00-.622-.264z",fill:"#C4C9CF"}))},R=["styles"],L=function(t){t.styles;var r=E(t,R);return e.createElement("svg",y({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M6.107 18.224l7.693-5.18a1.24 1.24 0 000-2.075L6.107 5.776C5.213 5.191 4 5.79 4 6.82v10.36c0 1.03 1.213 1.63 2.107 1.044zM17.333 6.273v11.454c0 .7.6 1.273 1.334 1.273C19.4 19 20 18.427 20 17.727V6.273C20 5.573 19.4 5 18.667 5c-.734 0-1.334.573-1.334 1.273z",fill:"#C4C9CF"}))},M=["styles"],D=function(t){t.styles;var r=E(t,M);return e.createElement("svg",y({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M17.893 18.224l-7.693-5.18a1.24 1.24 0 010-2.075l7.693-5.193C18.787 5.191 20 5.79 20 6.82v10.36c0 1.03-1.213 1.63-2.107 1.044zM6.667 6.273v11.454c0 .7-.6 1.273-1.334 1.273C4.6 19 4 18.427 4 17.727V6.273C4 5.573 4.6 5 5.333 5c.734 0 1.334.573 1.334 1.273z",fill:"#C4C9CF"}))},F=["styles"],H=function(t){t.styles;var r=E(t,F);return e.createElement("svg",y({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M18.79 13.71a.937.937 0 010 1.329l-1.876 1.875a.945.945 0 01-1.532-.305.938.938 0 01.204-1.023l.273-.274h-2.414a1.571 1.571 0 01-1.273-.656L6.39 6.562H2.5a.938.938 0 110-1.875h4.055a1.57 1.57 0 011.273.656l5.781 8.094h2.25l-.273-.273a.94.94 0 011.328-1.328l1.875 1.875zM8.624 11.922a.938.938 0 00-1.305.22l-.93 1.296H2.5a.937.937 0 100 1.875h4.055a1.571 1.571 0 001.273-.656l1.016-1.422a.945.945 0 00-.219-1.313zm2.75-3.843a.937.937 0 001.305-.219l.93-1.297h2.25l-.274.274a.937.937 0 00.664 1.6.946.946 0 00.664-.272l1.875-1.875a.937.937 0 000-1.328l-1.875-1.875a.94.94 0 00-1.328 1.328l.273.273h-2.414a1.57 1.57 0 00-1.273.656l-1.016 1.422a.945.945 0 00.219 1.313z",fill:"#C4C9CF"}))},z=["styles"],B=function(t){t.styles;var r=E(t,z);return e.createElement("svg",y({width:"40",height:"40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M8.333 31.394V8.606a1.667 1.667 0 012.449-1.472L32.23 18.528c1.18.627 1.18 2.317 0 2.944L10.782 32.866a1.667 1.667 0 01-2.449-1.472z",fill:"#fff"}))},I=["styles"],Y=function(t){t.styles;var r=E(t,I);return e.createElement("svg",y({width:"40",height:"40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M10 10c0-.92.746-1.666 1.667-1.666H15c.92 0 1.667.746 1.667 1.667v20c0 .92-.747 1.666-1.667 1.666h-3.333c-.92 0-1.667-.746-1.667-1.666V10zm13.333 0c0-.92.747-1.666 1.667-1.666h3.333c.92 0 1.667.746 1.667 1.667v20c0 .92-.746 1.666-1.667 1.666H25c-.92 0-1.667-.746-1.667-1.666V10z",fill:"#fff"}))};function G(t){var l,o=t.audioRef,i=t.progressBarRef,c=t.duration,u=t.setTimeProgress,s=t.setLoop,m=t.loop;t.dispatch;var f,p=t.playlist,d=t.waveform,v=void 0!==d&&d,y=a(),g="undefined"!=typeof window&&null!==(f=window.__CHEST_PLAYER_DEPS__)&&void 0!==f&&f.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{play:function(){return console.log("Play action not injected")},next:function(){return console.log("Next action not injected")},previous:function(){return console.log("Previous action not injected")},playing:function(){return console.log("Playing action not injected")}},E=g.play,w=g.next,b=g.previous,x=g.playing,_=n(function(){if(o.current){var e=o.current.currentTime,t=o.current.duration;u(e),!v&&i.current&&(i.current.value=e,i.current.style.setProperty("--range-progress","".concat(i.current.value/t*100,"%"))),y.current=requestAnimationFrame(_)}},[o,c,i,u]);r(function(){var e=function(e){32===e.keyCode&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),E())};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}},[E]);var P=function(){var e;if(null===(e=p[0])||void 0===e||!e.token)if(p.length>1)w();else{o.current&&(o.current.currentTime=0);var t=p[0];x(h(h({},t),{},{isPlaying:!1}))}};return r(function(){return o.current&&o.current.addEventListener("ended",P),function(){o.current&&o.current.removeEventListener("ended",P)}},[o.current,p]),r(function(){var e;if(null!==(e=p[0])&&void 0!==e&&e.isPlaying){var t=o.current.play();void 0!==t&&t.catch(function(e){console.log(e),o.current.pause()})}else o.current.pause();o.current.loop=!!m,y.current=requestAnimationFrame(_)},[m,o,_,p]),e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center"},e.createElement("button",{type:"button",className:"p-2 mr-2 disabled:opacity-30",disabled:!0},e.createElement(H,null)),e.createElement("button",{type:"button",onClick:function(){var e;null!==(e=p[0])&&void 0!==e&&e.token||b()},className:"p-2 player-controls"},e.createElement(D,null)),e.createElement("button",{type:"button",onClick:function(){E()},className:"player-controls"},null!==(l=p[0])&&void 0!==l&&l.isPlaying?e.createElement(Y,{width:40,height:40}):e.createElement(B,{width:40,height:40})),e.createElement("button",{type:"button",onClick:function(){var e;null!==(e=p[0])&&void 0!==e&&e.token||w()},className:"p-2 player-controls"},e.createElement(L,null)),e.createElement("button",{type:"button",className:"p-2 ml-2 ".concat(m?"player-controls-active":"player-controls"),onClick:function(){s(function(e){return!e})}},e.createElement(T,null))))}function V(t){var l,o,i=t.audioRef,c=t.progressBarRef;t.duration;var u=t.setTimeProgress;t.setLoop,t.loop,t.dispatch;var s,m=t.playlist,f=a(),p="undefined"!=typeof window&&null!==(s=window.__CHEST_PLAYER_DEPS__)&&void 0!==s&&s.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{play:function(){},playing:function(){}},d=p.play;p.playing;var v=n(function(){if(i.current&&c.current)try{var e=i.current.currentTime,t=i.current.duration;u(e),c.current.value=e,c.current.style.setProperty("--range-progress","".concat(c.current.value/t*100,"%")),f.current=requestAnimationFrame(v)}catch(e){console.error("Error in repeat:",e),cancelAnimationFrame(f.current)}},[i,c,u]);return r(function(){var e;if(null!==(e=i.current)&&void 0!==e&&e.src)return f.current=requestAnimationFrame(v),function(){f.current&&cancelAnimationFrame(f.current)}},[v,null===(l=i.current)||void 0===l?void 0:l.src]),e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center"},e.createElement("button",{type:"button",onClick:function(e){e.stopPropagation(),d()},className:"player-controls"},null!==(o=m[0])&&void 0!==o&&o.isPlaying?e.createElement(Y,{width:40,height:40}):e.createElement(B,{width:40,height:40}))))}function q(n){var l=n.audioRef;n.dispatch;var o,i=x(t(50),2),c=i[0],p=i[1],d=x(t(0),2),v=d[0],y=d[1],g=("undefined"!=typeof window&&null!==(o=window.__CHEST_PLAYER_DEPS__)&&void 0!==o&&o.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{reset:function(){return console.log("Reset action not injected")}}).reset,h=a();return r(function(){h.current.style.setProperty("--range-progress","".concat(h.current.value,"%")),l&&(l.current.volume=c/100)},[c,l]),e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center justify-end player-volume"},e.createElement("button",{type:"button",className:"p-2 disabled:opacity-30",disabled:!0},e.createElement(u,{className:"h-6 w-6 text-neutral-silver-200"})),e.createElement("button",{type:"button",className:"p-2",onClick:function(){c>0?(y(c),p(0)):p(v)}},0===c?e.createElement(s,{className:"h-6 w-6 text-neutral-silver-200"}):e.createElement(m,{className:"h-6 w-6 text-neutral-silver-200"})),e.createElement("input",{ref:h,type:"range",value:c,min:0,max:100,className:"bg-neutral-black rounded-lg h-1.5 appearance-none mr-4",onChange:function(e){p(parseInt(e.target.value))}}),e.createElement("button",{type:"button",className:"p-2 test",onClick:function(){g()}},e.createElement(f,{className:"h-6 w-6 text-white"}))))}function U(t){var r,a=t.currentTrack;t.audioRef,t.setDuration,t.progressBarRef;var l=t.dispatch,o=!(null===(r=t.playlist[0])||void 0===r||!r.token),i=n(function(){a&&l(void h(h({},a),{},{isPlaying:!a.isPlaying}))},[a,l]);return e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"flex gap-4 items-center"},e.createElement("div",{className:"w-[52px] h-[52px] bg-cover rounded cursor-pointer",style:{backgroundImage:"url(".concat(a.cover_url||"https://cdn.chestmusic.com/cover-default.jpg",")")},onClick:i}),e.createElement("div",{className:"flex flex-col gap-0.5"},e.createElement("div",{className:"flex flex-col grow"},e.createElement("div",{className:"w-full whitespace-nowrap overflow-hidden relative"},e.createElement("span",{className:"text-sm text-white inline-block"},a.name)),e.createElement("span",{className:"text-sm text-neutral-silver-200"},a.authors),o&&a.play_limit>0&&e.createElement("span",{className:"text-xs text-neutral-silver-300"},a.play_limit-a.plays," reproducciones restantes")))))}function W(t){var r,n,a=t.currentTrack;t.audioRef,t.setDuration,t.progressBarRef;var l=t.open;return e.createElement(e.Fragment,null,l?e.createElement("div",null,e.createElement("div",null,e.createElement("div",{className:"flex gap-3 items-center justify-center -mb-2"},e.createElement("div",{className:"w-[286px] h-[286px] bg-cover rounded",style:{backgroundImage:"url(".concat(a.cover_url,")")}})),e.createElement("div",{className:"rounded-3xl px-5 pt-2 backdrop-blur-xl flex flex-col gap-1 items-center justify-center h-[160px]",style:{background:"rgba(67, 71, 79, 0.30)"}},e.createElement("span",{className:"font-thunder-bold text-4xl uppercase !text-center"},a.name),e.createElement("span",{className:"text-neutral-silver-200"},null==a||null===(r=a.authors)||void 0===r?void 0:r.join(", "))))):e.createElement("div",{className:"flex items-center grow min-w-0"},e.createElement("div",{className:"flex gap-3 items-center min-w-0 flex-1"},e.createElement("div",{className:"w-10 h-10 bg-cover rounded min-w-[40px] flex-shrink-0",style:{backgroundImage:"url(".concat(a.cover_url,")")}}),e.createElement("div",{className:"flex flex-col min-w-0 flex-1"},e.createElement("div",{className:"w-full truncate"},e.createElement("span",{className:"text-sm text-white truncate"},a.name)),e.createElement("span",{className:"text-sm text-neutral-silver-200 truncate"},null==a||null===(n=a.authors)||void 0===n?void 0:n.join(", "))))))}function Q(o){var i,c,u,s,m,p=o.waveform,v=void 0!==p&&p,y=function(){if("undefined"!=typeof window&&window.__CHEST_PLAYER_DEPS__)return window.__CHEST_PLAYER_DEPS__;throw new Error("ChestPlayer: Dependencies not provided. Make sure to use PlayerProvider.")}(),g=y.apiHooks,h=g.useLazyGetTrackSourceQuery,E=g.useUpdateTrackPlayMutation,b=y.playlistActions,k=b.reset,j=b.play,O=y.playerActions,T=O.closePlayer,R=O.openPlayer,L=y.reduxProps,M=L.dispatch,D=L.playlist;L.playerState;var F=x(t(!1),2);F[0];var H=F[1],z=x(h(),2),B=z[0],I=z[1],Y=x(E(),2),Q=Y[0];Y[1];var X=N("PlayLimitModal").onOpen,$=P("(max-width: 768px)"),J=x(t(!1),2),K=J[0],Z=J[1],ee=x(t(0),2),te=ee[0],re=ee[1],ne=x(t(0),2),ae=ne[0],le=ne[1],oe=x(t(),2),ie=oe[0],ce=oe[1],ue=x(t(!1),2),se=ue[0],me=ue[1],fe=x(t(),2),pe=fe[0],de=fe[1],ve=x(t(0),2),ye=ve[0],ge=ve[1],he=x(t(null),2),Ee=he[0],we=he[1],be=x(t(!1),2);be[0];var xe=be[1],_e=x(t(!1),2),Pe=_e[0],Ne=_e[1],ke=x(t(!1),2),je=ke[0],Se=ke[1],Ce=a(),Ae=a(),Oe=!(null===(i=D[0])||void 0===i||!i.token),Te=x(t(null),2);Te[0],Te[1];var Re=x(t(!1),2);Re[0],Re[1];var Le=x(t(0),2);Le[0];var Me=Le[1],De=x(t(!1),2);De[0];var Fe=De[1],He=function(){me(function(e){return!e})};r(function(){M(se?R():T())},[se]),r(function(){k()},[]),r(function(){var e=ie,t=D&&D[0];if(t){if("object"===_(e)&&e.id===t.id)return;if(H(!1),ge(t.plays||0),we(t.play_limit||null),Se(!1),t.audio)ce({url:t.audio,cover_url:t.cover,name:t.name,authors:t.authors,type:t.type,id:t.id,plays:t.plays,play_limit:t.play_limit});else{var r=localStorage.getItem("chestmusic_session_id");B({id:t.id,session:r}).then(function(e){var r=e.data;r&&ce({url:r.url,cover_url:t.cover,name:t.name,authors:t.authors,type:t.type,id:t.id,plays:t.plays,play_limit:t.play_limit})})}}},[D,I]),r(function(){ie?pe!==ie.id&&de(ie.id):de("")},[ie]),n(function(){var e;if(Oe&&null!=ie&&ie.id&&null!==(e=D[0])&&void 0!==e&&e.token){var t="plays_".concat(ie.id,"_").concat(D[0].token),r=localStorage.getItem(t);return r?parseInt(r):0}return 0},[Oe,null==ie?void 0:ie.id,null===(c=D[0])||void 0===c?void 0:c.token]),r(function(){var e,t;Oe&&null!=ie&&ie.id&&null!==(e=D[0])&&void 0!==e&&e.token&&(ge(ie.plays||0),(ie.plays||0)>((null===(t=D[0])||void 0===t?void 0:t.play_limit)||0)&&(Ne(!0),Ce.current&&Ce.current.pause()))},[Oe,null==ie?void 0:ie.id,null===(u=D[0])||void 0===u?void 0:u.token,null==ie?void 0:ie.plays]);var ze=function(){if(Oe){var e,t,r=null===(e=D[0])||void 0===e?void 0:e.play_limit;if(r)if(ye>r||ye>=r&&je)return null===(t=Ce.current)||void 0===t||t.pause(),X(),!1}return!0},Be=function(){var e,t=(e=w().m(function e(){var t,r;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!Oe||Pe){e.n=4;break}return e.p=1,e.n=2,Q({id:ie.id,anonymous:!0,token:D[0].token});case 2:ge(t=ye+1),t>Ee&&(Ne(!0),X(),Ce.current&&Ce.current.pause()),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Error updating play count:",r);case 4:return e.a(2)}},e,null,[[1,3]])}),function(){var t=this,r=arguments;return new Promise(function(n,a){var l=e.apply(t,r);function o(e){d(l,n,a,o,i,"next",e)}function i(e){d(l,n,a,o,i,"throw",e)}o(void 0)})});return function(){return t.apply(this,arguments)}}();return r(function(){var e;ie&&null!==(e=D[0])&&void 0!==e&&e.isPlaying&&(ze()||M(j()))},[ie,null===(s=D[0])||void 0===s?void 0:s.isPlaying]),r(function(){var e;(null===(e=D[0])||void 0===e?void 0:e.id)!==pe&&(xe(!1),Fe(!1),Me(0),Se(!1))},[null===(m=D[0])||void 0===m?void 0:m.id]),e.createElement(e.Fragment,null,ie&&D.length>0&&e.createElement(e.Fragment,null,e.createElement("audio",{src:ie.url,ref:Ce,onLoadedMetadata:function(){var e=Ce.current.duration;le(e),!v&&Ae.current&&(Ae.current.max=e)},onEnded:function(){xe(!0),Fe(!1),Me(0),Se(!1)},onTimeUpdate:function(){if(Ce.current){var e=Ce.current.currentTime;e>.15*ae&&Fe(!0),Me(e),re(e)}},onPlay:function(){var e,t;ze()?((null===(e=Ce.current)||void 0===e?void 0:e.currentTime)||0)<.15*ae&&!je&&(Fe(!1),Be(),Se(!0)):null===(t=Ce.current)||void 0===t||t.pause()}}),Oe&&null!==Ee&&Ee>0&&e.createElement("div",{className:"fixed bottom-[102px] right-0 left-0 inset-x-0 max-w-max mx-auto z-50"},e.createElement(l.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},className:"px-6 py-3 bg-neutral-silver-600 rounded-t-xl"},e.createElement("span",{className:"text-brand-gold"},Math.max(0,Ee-ye))," of ",Ee," plays remaining")),$?e.createElement(e.Fragment,null,e.createElement("div",{className:"".concat(se?"audio-player-mobile-open":"audio-player-mobile")},se?e.createElement("div",{className:"bg-neutral-silver-700 rounded-3xl mb-3 gap-5 flex flex-col"},e.createElement("div",{className:"px-2 pt-2 flex flex-row justify-between"},e.createElement("button",{type:"button",className:"p-2.5",onClick:He},e.createElement(f,{className:"h-6 w-6 text-white"}))),e.createElement(W,{currentTrack:ie,audioRef:Ce,setDuration:le,progressBarRef:Ae,open:se,dispatch:M,playlist:D})):e.createElement("div",{className:"flex flex-row min-w-0 w-full",onClick:He},e.createElement(W,{currentTrack:ie,audioRef:Ce,setDuration:le,progressBarRef:Ae,dispatch:M,playlist:D}),e.createElement(V,{audioRef:Ce,progressBarRef:Ae,duration:ae,setTimeProgress:re,setLoop:Z,loop:K,dispatch:M,playlist:D})),e.createElement("div",{className:"".concat(se&&"bg-neutral-silver-600 px-5 pb-5 pt-4 rounded-3xl flex flex-col gap-1.5")},e.createElement("div",{className:"".concat(se&&"flex items-center justify-center gap-1.5")},se&&e.createElement(G,{audioRef:Ce,progressBarRef:Ae,duration:ae,setTimeProgress:re,setLoop:Z,loop:K,dispatch:M,playlist:D,waveform:v})),e.createElement(C,{progressBarRef:Ae,audioRef:Ce,timeProgress:te,duration:ae,open:se,playlist:D}))),se&&e.createElement("div",{className:"absolute top-0 left-0 w-screen h-screen bg-neutral-black"})):e.createElement(l.div,{className:"audio-player",initial:{height:0},animate:{height:"auto"},exit:{height:0,transition:{delay:.7,duration:1,ease:"easeIn"}}},e.createElement(U,{currentTrack:ie,audioRef:Ce,setDuration:le,progressBarRef:Ae,dispatch:M,playlist:D}),e.createElement("div",{className:"grow flex flex-col items-center justify-center gap-1.5"},e.createElement(G,{audioRef:Ce,progressBarRef:Ae,duration:ae,setTimeProgress:re,setLoop:Z,loop:K,dispatch:M,playlist:D,waveform:v}),v?e.createElement(A,{timeProgress:te,duration:ae,audioRef:Ce,open:se,playlist:D,currentTrack:ie}):e.createElement(S,{progressBarRef:Ae,audioRef:Ce,timeProgress:te,duration:ae,playlist:D})),e.createElement(q,{audioRef:Ce,dispatch:M}))))}var X=["apiHooks","playlistActions","playerActions","reduxProps"],$=function(t){var r=t.apiHooks,n=t.playlistActions,a=t.playerActions,l=t.reduxProps,o=E(t,X);return"undefined"!=typeof window&&(window.__CHEST_PLAYER_DEPS__={apiHooks:r,playlistActions:n,playerActions:a,reduxProps:l}),e.createElement(Q,o)};export{G as Controls,V as ControlsMobile,Q as Player,$ as PlayerProvider,S as ProgressBar,C as ProgressBarMobile,U as Track,W as TrackMobile,q as VolumeControls,A as WaveformProgressBar,P as useMediaQuery,N as useModal};
//# sourceMappingURL=index.esm.js.map
