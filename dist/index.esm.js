import*as e from"react";import{useState as t,useEffect as n,useCallback as r}from"react";import{motion as i}from"framer-motion";import{useDispatch as o,useSelector as a}from"react-redux";import{jsx as l,Fragment as c,jsxs as s}from"react/jsx-runtime";import{SpeakerXMarkIcon as u,SpeakerWaveIcon as d,ChevronDownIcon as f}from"@heroicons/react/24/outline";function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t,n,r,i,o,a){try{var l=e[o](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,i)}function h(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){h(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function g(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function w(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var c=r&&r.prototype instanceof l?r:l,s=Object.create(c.prototype);return b(s,"_invoke",function(n,r,i){var o,l,c,s=0,u=i||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,l=0,c=e,f.n=n,a}};function p(n,r){for(l=n,c=r,t=0;!d&&s&&!i&&t<u.length;t++){var i,o=u[t],p=f.p,v=o[2];n>3?(i=v===r)&&(c=o[(l=o[4])?5:(l=3,3)],o[4]=o[5]=e):o[0]<=p&&((i=n<2&&p<o[1])?(l=0,f.v=r,f.n=o[1]):p<v&&(i=n<3||o[0]>r||r>v)&&(o[4]=n,o[5]=r,f.n=v,l=0))}if(i||n>1)return a;throw d=!0,r}return function(i,u,v){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,v),l=u,c=v;(t=l<2?e:c)||!d;){o||(l?l<3?(l>1&&(f.n=-1),p(l,c)):f.n=c:f.v=c);try{if(s=2,o){if(l||(i="next"),t=o[i]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,l<2&&(l=0)}else 1===l&&(t=o.return)&&t.call(o),l<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),l=1);o=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==a)break}catch(t){o=e,l=1,c=t}finally{s=1}}return{value:t,done:d}}}(n,i,o),!0),s}var a={};function l(){}function c(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(b(t={},r,function(){return this}),t),d=s.prototype=l.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,b(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=s,b(d,"constructor",s),b(s,"constructor",c),c.displayName="GeneratorFunction",b(s,i,"GeneratorFunction"),b(d),b(d,i,"Generator"),b(d,r,function(){return this}),b(d,"toString",function(){return"[object Generator]"}),(w=function(){return{w:o,m:f}})()}function b(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}b=function(e,t,n,r){if(t)i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{function o(t,n){b(e,t,function(e){return this._invoke(t,n,e)})}o("next",0),o("throw",1),o("return",2)}},b(e,t,n,r)}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,l=[],c=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(l.push(r.value),l.length!==t);c=!0);}catch(e){s=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw i}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}var P=function(e){var r=x(t(!1),2),i=r[0],o=r[1];return n(function(){var t=window.matchMedia(e);t.matches!==i&&o(t.matches);var n=function(){return o(t.matches)};return window.addEventListener("resize",n),function(){return window.removeEventListener("resize",n)}},[i,e]),i};function N(e){var t,n=o(),i="undefined"!=typeof window&&null!==(t=window.__CHEST_PLAYER_DEPS__)&&void 0!==t&&t.modalActions?window.__CHEST_PLAYER_DEPS__.modalActions:{openModal:function(){},closeModal:function(){},isModalOpen:function(){return!1}},l=i.openModal,c=i.closeModal,s=i.isModalOpen,u=r(function(t){return n(l(e,t))},[n,l,e]),d=r(function(){return n(c(e))},[n,c,e]);return{isOpen:a(function(t){return s(t,e)}),onOpen:u,onClose:d}}function k(e){return Object.keys(e).map(function(t){return!0===e[t]?t:""}).join(" ")}var E=function(e){if(!e)return"0:00";"string"==typeof e&&(e=parseInt(e));var t=Math.floor(e/60),n=Math.floor(e%60),r=n<10?"0".concat(n):n;return"".concat(t,":").concat(r)};function S(e){var t,n=e.timeProgress,r=e.duration,i=e.progressBarRef,o=e.audioRef;e.open;var a=!(null===(t=e.playlist[0])||void 0===t||!t.token);return l(c,{children:s("div",{className:"w-full flex items-center gap-1.5 player-progressbar",children:[l("div",{className:"text-sm",children:E(n)}),l("input",{type:"range",defaultValue:0,step:.05,className:"bg-neutral-black rounded-lg h-1.5 appearance-none ".concat(a?"pointer-events-none":""),ref:i,onChange:function(){a||o.current&&i.current&&(o.current.currentTime=i.current.value)}}),l("div",{className:"text-sm",children:E(r)})]})})}function C(e){var t,n=e.timeProgress,r=e.duration,i=e.progressBarRef,o=e.audioRef,a=e.open,u=!(null===(t=e.playlist[0])||void 0===t||!t.token);return l(c,{children:s("div",{className:k({"w-full flex items-center player-progressbar":!0,"flex-col gap-2":a,"gap-1.5":!a}),children:[l("input",{type:"range",defaultValue:0,step:.05,className:k({"bg-neutral-black rounded-lg appearance-none":!0,"h-1.5":a,"h-[3px]":!a,"pointer-events-none":u}),ref:i,onChange:function(){u||o.current&&i.current&&(o.current.currentTime=i.current.value)}}),a&&s("div",{className:"grid grid-cols-2 w-full",children:[l("div",{className:"text-sm",children:E(n)}),l("div",{className:"text-sm text-right text-neutral-silver-200",children:E(r)})]})]})})}var j=["styles"],T=function(e){e.styles;var t=g(e,j);return l("svg",y(y({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:l("path",{d:"M1.668 10.001a5.776 5.776 0 011.634-4.028 5.513 5.513 0 013.936-1.672h7.255l-.257-.262a.902.902 0 01-.258-.637.92.92 0 01.258-.638.88.88 0 01.623-.264.863.863 0 01.623.264l1.759 1.8a.901.901 0 01.258.637.918.918 0 01-.258.638l-1.76 1.8a.876.876 0 01-1.245 0A.901.901 0 0113.977 7a.918.918 0 01.26-.637l.256-.263H7.238c-1.011 0-1.98.411-2.695 1.143A3.947 3.947 0 003.427 10a.91.91 0 01-.258.637.87.87 0 01-1.243 0A.91.91 0 011.668 10zm14.95-.9a.87.87 0 00-.622.264.91.91 0 00-.258.636 3.98 3.98 0 01-.29 1.493 3.907 3.907 0 01-.826 1.265c-.354.362-.774.65-1.236.845a3.735 3.735 0 01-1.458.297H4.673l.256-.262a.912.912 0 000-1.275.87.87 0 00-1.246 0l-1.758 1.8a.902.902 0 00-.259.637.918.918 0 00.259.637l1.758 1.8a.877.877 0 001.246 0 .901.901 0 00.259-.637.918.918 0 00-.259-.638l-.256-.262h7.255a5.513 5.513 0 003.936-1.672 5.776 5.776 0 001.633-4.028.91.91 0 00-.257-.636.87.87 0 00-.622-.264z",fill:"#C4C9CF"})}))},R=["styles"],A=function(e){e.styles;var t=g(e,R);return l("svg",y(y({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:l("path",{d:"M6.107 18.224l7.693-5.18a1.24 1.24 0 000-2.075L6.107 5.776C5.213 5.191 4 5.79 4 6.82v10.36c0 1.03 1.213 1.63 2.107 1.044zM17.333 6.273v11.454c0 .7.6 1.273 1.334 1.273C19.4 19 20 18.427 20 17.727V6.273C20 5.573 19.4 5 18.667 5c-.734 0-1.334.573-1.334 1.273z",fill:"#C4C9CF"})}))},O=["styles"],L=function(e){e.styles;var t=g(e,O);return l("svg",y(y({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:l("path",{d:"M17.893 18.224l-7.693-5.18a1.24 1.24 0 010-2.075l7.693-5.193C18.787 5.191 20 5.79 20 6.82v10.36c0 1.03-1.213 1.63-2.107 1.044zM6.667 6.273v11.454c0 .7-.6 1.273-1.334 1.273C4.6 19 4 18.427 4 17.727V6.273C4 5.573 4.6 5 5.333 5c.734 0 1.334.573 1.334 1.273z",fill:"#C4C9CF"})}))},M=["styles"],H=function(e){e.styles;var t=g(e,M);return l("svg",y(y({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:l("path",{d:"M18.79 13.71a.937.937 0 010 1.329l-1.876 1.875a.945.945 0 01-1.532-.305.938.938 0 01.204-1.023l.273-.274h-2.414a1.571 1.571 0 01-1.273-.656L6.39 6.562H2.5a.938.938 0 110-1.875h4.055a1.57 1.57 0 011.273.656l5.781 8.094h2.25l-.273-.273a.94.94 0 011.328-1.328l1.875 1.875zM8.624 11.922a.938.938 0 00-1.305.22l-.93 1.296H2.5a.937.937 0 100 1.875h4.055a1.571 1.571 0 001.273-.656l1.016-1.422a.945.945 0 00-.219-1.313zm2.75-3.843a.937.937 0 001.305-.219l.93-1.297h2.25l-.274.274a.937.937 0 00.664 1.6.946.946 0 00.664-.272l1.875-1.875a.937.937 0 000-1.328l-1.875-1.875a.94.94 0 00-1.328 1.328l.273.273h-2.414a1.57 1.57 0 00-1.273.656l-1.016 1.422a.945.945 0 00.219 1.313z",fill:"#C4C9CF"})}))},D=["styles"],z=function(e){e.styles;var t=g(e,D);return l("svg",y(y({width:"40",height:"40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:l("path",{d:"M8.333 31.394V8.606a1.667 1.667 0 012.449-1.472L32.23 18.528c1.18.627 1.18 2.317 0 2.944L10.782 32.866a1.667 1.667 0 01-2.449-1.472z",fill:"#fff"})}))},Y=["styles"],B=function(e){e.styles;var t=g(e,Y);return l("svg",y(y({width:"40",height:"40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:l("path",{d:"M10 10c0-.92.746-1.666 1.667-1.666H15c.92 0 1.667.746 1.667 1.667v20c0 .92-.747 1.666-1.667 1.666h-3.333c-.92 0-1.667-.746-1.667-1.666V10zm13.333 0c0-.92.747-1.666 1.667-1.666h3.333c.92 0 1.667.746 1.667 1.667v20c0 .92-.746 1.666-1.667 1.666H25c-.92 0-1.667-.746-1.667-1.666V10z",fill:"#fff"})}))},I=e.useRef,F=e.useCallback,G=e.useEffect;function V(e){var t,n=e.audioRef,r=e.progressBarRef,i=e.duration,o=e.setTimeProgress,a=e.setLoop,u=e.loop;e.dispatch;var d,f,p=e.playlist,v=e.mobileExpanded,h=void 0!==v&&v,m=I(),g="undefined"!=typeof window&&null!==(d=window.__CHEST_PLAYER_DEPS__)&&void 0!==d&&d.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{play:function(){return console.log("Play action not injected")},next:function(){return console.log("Next action not injected")},previous:function(){return console.log("Previous action not injected")},playing:function(){return console.log("Playing action not injected")},toggleShuffle:function(){return console.log("ToggleShuffle action not injected")}},w=g.play,b=g.next,x=g.previous,_=g.playing,P=g.toggleShuffle,N="undefined"!=typeof window&&null!==(f=window.__CHEST_PLAYER_DEPS__)&&void 0!==f&&null!==(f=f.reduxProps)&&void 0!==f&&f.playlistState?window.__CHEST_PLAYER_DEPS__.reduxProps.playlistState:{shuffle:!1,context:"my-chest"},k=F(function(){if(n.current&&r.current){var e=n.current.currentTime,t=n.current.duration;o(e),r.current.value=e,r.current.style.setProperty("--range-progress","".concat(r.current.value/t*100,"%")),m.current=requestAnimationFrame(k)}},[n,i,r,o]),E=function(){w()};G(function(){var e=function(e){32===e.keyCode&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),w())};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}},[w]);var S,C=function(){a(function(e){return!e})},j=function(){b()},R=function(){x()},O=function(){P()},M=function(){var e;if(null===(e=p[0])||void 0===e||!e.token)if(p.length>1)b();else{n.current&&(n.current.currentTime=0);var t=p[0];_(y(y({},t),{},{isPlaying:!1}))}};return G(function(){return n.current&&n.current.addEventListener("ended",M),function(){n.current&&n.current.removeEventListener("ended",M)}},[n.current,p]),G(function(){var e;if(null!==(e=p[0])&&void 0!==e&&e.isPlaying){var t=n.current.play();void 0!==t&&t.catch(function(){n.current.pause()})}else n.current.pause();n.current.loop=!!u,m.current=requestAnimationFrame(k)},[u,n,k,p]),h?s("div",{className:"w-full px-4 flex items-center justify-between",children:[l("button",{type:"button",className:"".concat(N.shuffle?"player-controls-active":"player-controls"),onClick:O,children:l(H,{width:20,height:20})}),s("div",{className:"flex items-center gap-6",children:[l("button",{type:"button",onClick:R,className:"text-neutral-silver-200 hover:text-white",children:l(L,{width:24,height:24})}),l("button",{type:"button",onClick:E,className:"text-white hover:scale-105 transition-transform",children:null!==(S=p[0])&&void 0!==S&&S.isPlaying?l(B,{width:34,height:34}):l(z,{width:34,height:34})}),l("button",{type:"button",onClick:j,className:"text-neutral-silver-200 hover:text-white",children:l(A,{width:24,height:24})})]}),l("button",{type:"button",className:"".concat(u?"player-controls-active":"player-controls"),onClick:C,children:l(T,{width:20,height:20})})]}):l(c,{children:s("div",{className:"flex items-center",children:[l("button",{type:"button",className:"p-2 mr-2 ".concat(N.shuffle?"player-controls-active":"player-controls"),onClick:O,children:l(H,{})}),l("button",{type:"button",onClick:R,className:"p-2 player-controls",children:l(L,{})}),l("button",{type:"button",onClick:E,className:"player-controls",children:null!==(t=p[0])&&void 0!==t&&t.isPlaying?l(B,{width:40,height:40}):l(z,{width:40,height:40})}),l("button",{type:"button",onClick:j,className:"p-2 player-controls",children:l(A,{})}),l("button",{type:"button",className:"p-2 ml-2 ".concat(u?"player-controls-active":"player-controls"),onClick:C,children:l(T,{})})]})})}var q=e.useRef,U=e.useCallback,X=e.useEffect;function Q(e){var t,n,r,i=e.audioRef,o=e.progressBarRef;e.duration;var a=e.setTimeProgress;e.setLoop,e.loop,e.dispatch;var s,u=e.playlist,d=q(),f="undefined"!=typeof window&&null!==(s=window.__CHEST_PLAYER_DEPS__)&&void 0!==s&&s.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{play:function(){},playing:function(){}},p=f.play;f.playing;var v=U(function(){if(i.current&&o.current)try{var e=i.current.currentTime,t=i.current.duration;a(e),o.current&&(o.current.value=e,o.current.style.setProperty("--range-progress","".concat(o.current.value/t*100,"%"))),d.current=requestAnimationFrame(v)}catch(e){cancelAnimationFrame(d.current)}},[i,o,a]);return X(function(){var e;if(null!==(e=i.current)&&void 0!==e&&e.src)return d.current=requestAnimationFrame(v),function(){d.current&&cancelAnimationFrame(d.current)}},[v,null===(t=i.current)||void 0===t?void 0:t.src]),X(function(){var e,t;if(null!==(e=u[0])&&void 0!==e&&e.isPlaying&&i.current){var n=i.current.play();void 0!==n&&n.catch(function(){i.current.pause()})}else null!==(t=u[0])&&void 0!==t&&t.isPlaying||!i.current||i.current.pause();d.current=requestAnimationFrame(v)},[null===(n=u[0])||void 0===n?void 0:n.isPlaying,i,v]),l(c,{children:l("div",{className:"flex items-center",children:l("button",{type:"button",onClick:function(e){e.stopPropagation(),p()},className:"player-controls",children:null!==(r=u[0])&&void 0!==r&&r.isPlaying?l(B,{width:40,height:40}):l(z,{width:40,height:40})})})})}var $=e.useEffect,J=e.useRef,K=e.useState;function W(e){var t=e.audioRef;e.dispatch;var n,r=x(K(50),2),i=r[0],o=r[1],a=x(K(0),2),p=a[0],v=a[1],h=("undefined"!=typeof window&&null!==(n=window.__CHEST_PLAYER_DEPS__)&&void 0!==n&&n.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{reset:function(){return console.log("Reset action not injected")}}).reset,m=J();return $(function(){m.current.style.setProperty("--range-progress","".concat(m.current.value,"%")),t&&(t.current.volume=i/100)},[i,t]),l(c,{children:s("div",{className:"flex items-center justify-end player-volume",children:[l("button",{type:"button",className:"p-2",onClick:function(){i>0?(v(i),o(0)):o(p)},children:l(0===i?u:d,{className:"h-6 w-6 text-neutral-silver-200"})}),l("input",{ref:m,type:"range",value:i,min:0,max:100,className:"bg-neutral-black rounded-lg h-1.5 appearance-none mr-4",onChange:function(e){o(parseInt(e.target.value))}}),l("button",{type:"button",className:"p-2 test",onClick:function(){h()},children:l(f,{className:"h-6 w-6 text-white"})})]})})}var Z=e.useCallback;function ee(e){var t,n=e.currentTrack;e.audioRef,e.setDuration,e.progressBarRef;var r=e.dispatch,i=!(null===(t=e.playlist[0])||void 0===t||!t.token),o=Z(function(){n&&r(void y(y({},n),{},{isPlaying:!n.isPlaying}))},[n,r]);return l("div",{className:"flex items-center",children:s("div",{className:"flex gap-4 items-center",children:[l("div",{className:"w-[52px] h-[52px] bg-cover rounded cursor-pointer",style:{backgroundImage:"url(".concat(n.cover_url||"https://cdn.chestmusic.com/cover-default.jpg",")")},onClick:o}),l("div",{className:"flex flex-col gap-0.5",children:s("div",{className:"flex flex-col grow",children:[l("div",{className:"w-full whitespace-nowrap overflow-hidden relative",children:l("span",{className:"text-sm text-white inline-block",children:n.name})}),l("span",{className:"text-sm text-neutral-silver-200",children:n.authors}),i&&n.play_limit>0&&s("span",{className:"text-xs text-neutral-silver-300",children:[n.play_limit-n.plays," reproducciones restantes"]})]})})]})})}function te(e){var t,n,r=e.currentTrack;e.audioRef,e.setDuration,e.progressBarRef;var i=e.open;return l(c,{children:l("div",i?{children:s("div",{children:[l("div",{className:"flex gap-3 items-center justify-center -mb-2",children:l("div",{className:"w-[286px] h-[286px] bg-cover rounded",style:{backgroundImage:"url(".concat(r.cover_url,")")}})}),s("div",{className:"rounded-3xl px-5 pt-2 backdrop-blur-xl flex flex-col gap-1 items-center justify-center h-[160px]",style:{background:"rgba(67, 71, 79, 0.30)"},children:[l("span",{className:"font-thunder-bold text-4xl uppercase !text-center",children:r.name}),l("span",{className:"text-neutral-silver-200",children:null==r||null===(t=r.authors)||void 0===t?void 0:t.join(", ")})]})]})}:{className:"flex items-center grow min-w-0",children:s("div",{className:"flex gap-3 items-center min-w-0 flex-1",children:[l("div",{className:"w-10 h-10 bg-cover rounded min-w-[40px] flex-shrink-0",style:{backgroundImage:"url(".concat(r.cover_url||"https://cdn.chestmusic.com/cover-default.jpg",")")}}),s("div",{className:"flex flex-col min-w-0 flex-1",children:[l("div",{className:"w-full truncate",children:l("span",{className:"text-sm text-white truncate",children:r.name})}),l("span",{className:"text-sm text-neutral-silver-200 truncate",children:null==r||null===(n=r.authors)||void 0===n?void 0:n.join(", ")})]})]})})})}var ne=e.useEffect,re=e.useRef,ie=e.useState,oe=e.useCallback;function ae(){var e,t,n,r,o,a,u=function(){if("undefined"!=typeof window&&window.__CHEST_PLAYER_DEPS__)return window.__CHEST_PLAYER_DEPS__;throw new Error("ChestPlayer: Dependencies not provided. Make sure to use PlayerProvider.")}(),d=u.apiHooks,p=d.useLazyGetTrackSourceQuery,h=d.useUpdateTrackPlayMutation,m=u.playlistActions,y=m.reset,g=m.play,b=u.playerActions,k=b.closePlayer,E=b.openPlayer,j=u.reduxProps,T=j.dispatch,R=j.playlist;j.playerState;var A=x(ie(!1),2);A[0];var O=A[1],L=x(p(),2),M=L[0],H=L[1],D=x(h(),2),z=D[0];D[1];var Y=N("PlayLimitModal").onOpen,B=P("(max-width: 768px)"),I=x(ie(!1),2),F=I[0],G=I[1],q=x(ie(0),2),U=q[0],X=q[1],$=x(ie(0),2),J=$[0],K=$[1],Z=x(ie(),2),ae=Z[0],le=Z[1],ce=x(ie(!1),2),se=ce[0],ue=ce[1],de=x(ie(),2),fe=de[0],pe=de[1],ve=x(ie(0),2),he=ve[0],me=ve[1],ye=x(ie(null),2),ge=ye[0],we=ye[1],be=x(ie(!1),2);be[0];var xe=be[1],_e=x(ie(!1),2),Pe=_e[0],Ne=_e[1],ke=x(ie(!1),2),Ee=ke[0],Se=ke[1],Ce=x(ie(0),2),je=Ce[0],Te=Ce[1],Re=x(ie(!1),2),Ae=Re[0],Oe=Re[1],Le=x(ie(0),2);Le[0];var Me=Le[1],He=re(),De=re(),ze=re(),Ye=!(null===(e=R[0])||void 0===e||!e.token),Be=x(ie(null),2);Be[0],Be[1];var Ie=x(ie(!1),2);Ie[0],Ie[1];var Fe=x(ie(0),2);Fe[0];var Ge=Fe[1],Ve=x(ie(!1),2);Ve[0];var qe=Ve[1],Ue=function(){ue(function(e){return!e})},Xe=x(ie(0),2),Qe=Xe[0],$e=Xe[1],Je=x(ie(!1),2),Ke=Je[0],We=Je[1],Ze=re();ne(function(){T(se?E():k())},[se]),ne(function(){y()},[]),ne(function(){var e=ae,t=R&&R[0];if(t){if("object"===_(e)&&e.id===t.id)return;if(O(!1),me(t.plays||0),we(t.play_limit||null),Se(!1),t.audio)le({url:t.audio,cover_url:t.cover||"https://cdn.chestmusic.com/cover-default.jpg",name:t.name,authors:t.authors,type:t.type,id:t.id,plays:t.plays,play_limit:t.play_limit});else{var n=localStorage.getItem("chestmusic_session_id");M({id:t.id,session:n}).then(function(e){var n=e.data;n&&le({url:n.url,cover_url:t.cover||"https://cdn.chestmusic.com/cover-default.jpg",name:t.name,authors:t.authors,type:t.type,id:t.id,plays:t.plays,play_limit:t.play_limit})})}}},[R,H]),ne(function(){ae?fe!==ae.id&&pe(ae.id):pe("")},[ae]),oe(function(){var e;if(Ye&&null!=ae&&ae.id&&null!==(e=R[0])&&void 0!==e&&e.token){var t="plays_".concat(ae.id,"_").concat(R[0].token),n=localStorage.getItem(t);return n?parseInt(n):0}return 0},[Ye,null==ae?void 0:ae.id,null===(t=R[0])||void 0===t?void 0:t.token]),ne(function(){var e,t;Ye&&null!=ae&&ae.id&&null!==(e=R[0])&&void 0!==e&&e.token&&(me(ae.plays||0),(ae.plays||0)>((null===(t=R[0])||void 0===t?void 0:t.play_limit)||0)&&(Ne(!0),He.current&&He.current.pause()))},[Ye,null==ae?void 0:ae.id,null===(n=R[0])||void 0===n?void 0:n.token,null==ae?void 0:ae.plays]);var et=function(){if(Ye){var e,t,n=null===(e=R[0])||void 0===e?void 0:e.play_limit;if(n)if(he>n||he>=n&&Ee)return null===(t=He.current)||void 0===t||t.pause(),Y(),!1}return!0},tt=function(){var e,t=(e=w().m(function e(){var t;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!Ye||Pe){e.n=4;break}return e.p=1,e.n=2,z({id:ae.id,anonymous:!0,token:R[0].token});case 2:me(t=he+1),t>ge&&(Ne(!0),Y(),He.current&&He.current.pause()),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[1,3]])}),function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){v(o,r,i,a,l,"next",e)}function l(e){v(o,r,i,a,l,"throw",e)}a(void 0)})});return function(){return t.apply(this,arguments)}}();return ne(function(){var e;if(ae&&null!==(e=R[0])&&void 0!==e&&e.isPlaying){if(!et())return void T(g());if(He.current){var t=He.current.play();void 0!==t&&t.catch(function(e){})}}},[ae,null===(r=R[0])||void 0===r?void 0:r.isPlaying]),ne(function(){var e;(null===(e=R[0])||void 0===e?void 0:e.id)!==fe&&(xe(!1),qe(!1),Ge(0),Se(!1))},[null===(o=R[0])||void 0===o?void 0:o.id]),l(c,{children:ae&&R.length>0&&s(c,{children:[l("audio",{src:ae.url,ref:He,onLoadedMetadata:function(){var e=He.current.duration;K(e),De.current&&(De.current.max=e)},onEnded:function(){xe(!0),qe(!1),Ge(0),Se(!1)},onTimeUpdate:function(){if(He.current){var e=He.current.currentTime;e>.15*J&&qe(!0),Ge(e),X(e)}},onPlay:function(){var e,t;et()?((null===(e=He.current)||void 0===e?void 0:e.currentTime)||0)<.15*J&&!Ee&&(qe(!1),tt(),Se(!0)):null===(t=He.current)||void 0===t||t.pause()}}),Ye&&null!==ge&&ge>0&&l("div",{className:"fixed bottom-[102px] right-0 left-0 inset-x-0 max-w-max mx-auto z-50",children:s(i.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},className:"px-6 py-3 bg-neutral-silver-600 rounded-t-xl",children:[l("span",{className:"text-brand-gold",children:Math.max(0,ge-he)})," of ",ge," plays remaining"]})}),B?l(c,{children:l("div",{className:"".concat(se?"audio-player-mobile-open":"audio-player-mobile"),children:s("div",se?{className:"fixed inset-0 z-50 flex items-center justify-center",children:[l("div",{className:"absolute top-0 left-0 w-screen h-screen",style:{backgroundColor:"rgba(0, 0, 0, 0.6)"}}),s("div",{ref:Ze,className:"relative z-50 backdrop-blur-md rounded-2xl m-4 flex flex-col w-full max-w-sm bg-black",onTouchStart:function(e){$e(e.touches[0].clientY),We(!0),Ze.current&&(Ze.current.style.transition="none")},onTouchMove:function(e){if(Qe&&Ke){var t=e.touches[0].clientY-Qe;t>0&&Ze.current&&(Ze.current.style.transform="translateY(".concat(t,"px)"),Ze.current.style.opacity=Math.max(.3,1-t/300))}},onTouchEnd:function(e){if(Qe&&Ke){var t=e.changedTouches[0].clientY-Qe;Ze.current&&(Ze.current.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",t>150?(Ze.current.style.transform="translateY(100vh)",Ze.current.style.opacity="0",setTimeout(function(){ue(!1),Ze.current&&(Ze.current.style.transform="translateY(0)",Ze.current.style.opacity="1",Ze.current.style.transition="")},300)):(Ze.current.style.transform="translateY(0)",Ze.current.style.opacity="1",setTimeout(function(){Ze.current&&(Ze.current.style.transition="")},300))),$e(0),We(!1)}},children:[l("div",{className:"absolute top-4 right-4 z-60",children:l("button",{type:"button",className:"p-2 test",onClick:Ue,children:l(f,{className:"h-6 w-6 text-white"})})}),s("div",{className:"flex flex-col items-center justify-center px-4 py-4",children:[l("div",{className:"text-center mb-2",children:l("span",{className:"font-thunder-bold text-white text-center block",style:{fontSize:"32px",lineHeight:"1.1"},children:ae.name})}),l("div",{className:"text-center mb-4",children:l("span",{className:"text-neutral-silver-200",style:{fontSize:"16px"},children:null==ae||null===(a=ae.authors)||void 0===a?void 0:a.join(", ")})}),l("div",{className:"mb-8 w-full px-4",children:l("div",{className:"w-full shadow-2xl max-w-sm mx-auto",style:{aspectRatio:"1",minHeight:"200px",backgroundImage:"url(".concat(ae.cover_url||"https://cdn.chestmusic.com/cover-default.jpg",")"),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",borderRadius:"11px"}})}),l("div",{className:"w-full px-4 mb-4",children:l(C,{progressBarRef:De,audioRef:He,timeProgress:U,duration:J,open:se,playlist:R})}),l(V,{audioRef:He,progressBarRef:De,duration:J,setTimeProgress:X,setLoop:G,loop:F,dispatch:T,playlist:R,mobileExpanded:!0})]})]})]}:{ref:ze,className:"flex flex-row min-w-0 w-full ".concat(Ae?"swiping":""),onClick:Ue,onTouchStart:function(e){Te(e.touches[0].clientX),Oe(!1),Me(0)},onTouchMove:function(e){if(je){var t=e.touches[0].clientX-je;Oe(!0),Me(t),ze.current&&ze.current.style.setProperty("--swipe-distance","".concat(t,"px"))}},onTouchEnd:function(e){if(je){var t=e.changedTouches[0].clientX,n=Math.abs(je-t);Oe(!1),Me(0),ze.current&&ze.current.style.setProperty("--swipe-distance","0px"),n>100&&T(k()),Te(0)}},children:[l(te,{currentTrack:ae,audioRef:He,setDuration:K,progressBarRef:De,dispatch:T,playlist:R}),l(Q,{audioRef:He,progressBarRef:De,duration:J,setTimeProgress:X,setLoop:G,loop:F,dispatch:T,playlist:R})]})})}):s(i.div,{className:"audio-player",initial:{height:0},animate:{height:"auto"},exit:{height:0,transition:{delay:.7,duration:1,ease:"easeIn"}},children:[l(ee,{currentTrack:ae,audioRef:He,setDuration:K,progressBarRef:De,dispatch:T,playlist:R}),s("div",{className:"grow flex flex-col items-center justify-center gap-1.5",children:[l(V,{audioRef:He,progressBarRef:De,duration:J,setTimeProgress:X,setLoop:G,loop:F,dispatch:T,playlist:R}),l(S,{progressBarRef:De,audioRef:He,timeProgress:U,duration:J,playlist:R})]}),l(W,{audioRef:He,dispatch:T})]})]})})}var le=["apiHooks","playlistActions","playerActions","reduxProps"],ce=function(e){var t=e.apiHooks,n=e.playlistActions,r=e.playerActions,i=e.reduxProps,o=g(e,le);return"undefined"!=typeof window&&(window.__CHEST_PLAYER_DEPS__={apiHooks:t,playlistActions:n,playerActions:r,reduxProps:i}),l(ae,y({},o))},se=function(e){return"string"!=typeof e||0===e.length?"":e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()};export{V as Controls,Q as ControlsMobile,ae as Player,ce as PlayerProvider,S as ProgressBar,C as ProgressBarMobile,ee as Track,te as TrackMobile,W as VolumeControls,se as capitalize,P as useMediaQuery,N as useModal};
//# sourceMappingURL=index.esm.js.map
