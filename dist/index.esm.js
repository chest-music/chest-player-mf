import*as e from"react";import t,{useState as n,useEffect as r,useCallback as a}from"react";import{motion as l}from"framer-motion";import{useDispatch as o,useSelector as i}from"react-redux";import{ClockIcon as c,SpeakerXMarkIcon as u,SpeakerWaveIcon as s,ChevronDownIcon as m}from"@heroicons/react/24/outline";function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t,n,r,a,l,o){try{var i=e[l](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function d(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(null,arguments)}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){d(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function g(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function E(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function l(n,r,a,l){var c=r&&r.prototype instanceof i?r:i,u=Object.create(c.prototype);return w(u,"_invoke",function(n,r,a){var l,i,c,u=0,s=a||[],m=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return l=t,i=0,c=e,f.n=n,o}};function p(n,r){for(i=n,c=r,t=0;!m&&u&&!a&&t<s.length;t++){var a,l=s[t],p=f.p,d=l[2];n>3?(a=d===r)&&(c=l[(i=l[4])?5:(i=3,3)],l[4]=l[5]=e):l[0]<=p&&((a=n<2&&p<l[1])?(i=0,f.v=r,f.n=l[1]):p<d&&(a=n<3||l[0]>r||r>d)&&(l[4]=n,l[5]=r,f.n=d,i=0))}if(a||n>1)return o;throw m=!0,r}return function(a,s,d){if(u>1)throw TypeError("Generator is already running");for(m&&1===s&&p(s,d),i=s,c=d;(t=i<2?e:c)||!m;){l||(i?i<3?(i>1&&(f.n=-1),p(i,c)):f.n=c:f.v=c);try{if(u=2,l){if(i||(a="next"),t=l[a]){if(!(t=t.call(l,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=l.return)&&t.call(l),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);l=e}else if((t=(m=f.n<0)?c:n.call(r,f))!==o)break}catch(t){l=e,i=1,c=t}finally{u=1}}return{value:t,done:m}}}(n,a,l),!0),u}var o={};function i(){}function c(){}function u(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(w(t={},r,function(){return this}),t),m=u.prototype=i.prototype=Object.create(s);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,w(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return c.prototype=u,w(m,"constructor",u),w(u,"constructor",c),c.displayName="GeneratorFunction",w(u,a,"GeneratorFunction"),w(m),w(m,a,"Generator"),w(m,r,function(){return this}),w(m,"toString",function(){return"[object Generator]"}),(E=function(){return{w:l,m:f}})()}function w(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}w=function(e,t,n,r){if(t)a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{function l(t,n){w(e,t,function(e){return this._invoke(t,n,e)})}l("next",0),l("throw",1),l("return",2)}},w(e,t,n,r)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,l,o,i=[],c=!0,u=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=l.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}var _=function(e){var t=b(n(!1),2),a=t[0],l=t[1];return r(function(){var t=window.matchMedia(e);t.matches!==a&&l(t.matches);var n=function(){return l(t.matches)};return window.addEventListener("resize",n),function(){return window.removeEventListener("resize",n)}},[a,e]),a};function P(e){var t,n=o(),r="undefined"!=typeof window&&null!==(t=window.__CHEST_PLAYER_DEPS__)&&void 0!==t&&t.modalActions?window.__CHEST_PLAYER_DEPS__.modalActions:{openModal:function(){},closeModal:function(){},isModalOpen:function(){return!1}},l=r.openModal,c=r.closeModal,u=r.isModalOpen,s=a(function(t){return n(l(e,t))},[n,l,e]),m=a(function(){return n(c(e))},[n,c,e]);return{isOpen:i(function(t){return u(t,e)}),onOpen:s,onClose:m}}function N(e){return Object.keys(e).map(function(t){return!0===e[t]?t:""}).join(" ")}var k=function(e){if(!e)return"0:00";"string"==typeof e&&(e=parseInt(e));var t=Math.floor(e/60),n=Math.floor(e%60),r=n<10?"0".concat(n):n;return"".concat(t,":").concat(r)};function C(t){var n,r=t.timeProgress,a=t.duration,l=t.progressBarRef,o=t.audioRef;t.open;var i=!(null===(n=t.playlist[0])||void 0===n||!n.token);return e.createElement(e.Fragment,null,e.createElement("div",{className:"w-full flex items-center gap-1.5 player-progressbar"},e.createElement("div",{className:"text-sm"},k(r)),e.createElement("input",{type:"range",defaultValue:0,step:.05,className:"bg-neutral-black rounded-lg h-1.5 appearance-none ".concat(i?"pointer-events-none":""),ref:l,onChange:function(){i||(o.current.currentTime=l.current.value)}}),e.createElement("div",{className:"text-sm"},k(a))))}function S(t){var n,r=t.timeProgress,a=t.duration,l=t.progressBarRef,o=t.audioRef,i=t.open,c=!(null===(n=t.playlist[0])||void 0===n||!n.token);return e.createElement(e.Fragment,null,e.createElement("div",{className:N({"w-full flex items-center player-progressbar":!0,"flex-col gap-2":i,"gap-1.5":!i})},i&&e.createElement("div",{className:"grid grid-cols-2 w-full"},e.createElement("div",{className:"text-sm"},k(r)),e.createElement("div",{className:"text-sm text-right text-neutral-silver-200"},k(a))),e.createElement("input",{type:"range",defaultValue:0,step:.05,className:N({"bg-neutral-black rounded-lg appearance-none":!0,"h-1.5":i,"h-[3px]":!i,"pointer-events-none":c}),ref:l,onChange:function(){c||(o.current.currentTime=l.current.value)}})))}var j=["styles"],T=function(e){e.styles;var n=g(e,j);return t.createElement("svg",v({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),t.createElement("path",{d:"M1.668 10.001a5.776 5.776 0 011.634-4.028 5.513 5.513 0 013.936-1.672h7.255l-.257-.262a.902.902 0 01-.258-.637.92.92 0 01.258-.638.88.88 0 01.623-.264.863.863 0 01.623.264l1.759 1.8a.901.901 0 01.258.637.918.918 0 01-.258.638l-1.76 1.8a.876.876 0 01-1.245 0A.901.901 0 0113.977 7a.918.918 0 01.26-.637l.256-.263H7.238c-1.011 0-1.98.411-2.695 1.143A3.947 3.947 0 003.427 10a.91.91 0 01-.258.637.87.87 0 01-1.243 0A.91.91 0 011.668 10zm14.95-.9a.87.87 0 00-.622.264.91.91 0 00-.258.636 3.98 3.98 0 01-.29 1.493 3.907 3.907 0 01-.826 1.265c-.354.362-.774.65-1.236.845a3.735 3.735 0 01-1.458.297H4.673l.256-.262a.912.912 0 000-1.275.87.87 0 00-1.246 0l-1.758 1.8a.902.902 0 00-.259.637.918.918 0 00.259.637l1.758 1.8a.877.877 0 001.246 0 .901.901 0 00.259-.637.918.918 0 00-.259-.638l-.256-.262h7.255a5.513 5.513 0 003.936-1.672 5.776 5.776 0 001.633-4.028.91.91 0 00-.257-.636.87.87 0 00-.622-.264z",fill:"#C4C9CF"}))},O=["styles"],R=function(e){e.styles;var n=g(e,O);return t.createElement("svg",v({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),t.createElement("path",{d:"M6.107 18.224l7.693-5.18a1.24 1.24 0 000-2.075L6.107 5.776C5.213 5.191 4 5.79 4 6.82v10.36c0 1.03 1.213 1.63 2.107 1.044zM17.333 6.273v11.454c0 .7.6 1.273 1.334 1.273C19.4 19 20 18.427 20 17.727V6.273C20 5.573 19.4 5 18.667 5c-.734 0-1.334.573-1.334 1.273z",fill:"#C4C9CF"}))},A=["styles"],L=function(e){e.styles;var n=g(e,A);return t.createElement("svg",v({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),t.createElement("path",{d:"M17.893 18.224l-7.693-5.18a1.24 1.24 0 010-2.075l7.693-5.193C18.787 5.191 20 5.79 20 6.82v10.36c0 1.03-1.213 1.63-2.107 1.044zM6.667 6.273v11.454c0 .7-.6 1.273-1.334 1.273C4.6 19 4 18.427 4 17.727V6.273C4 5.573 4.6 5 5.333 5c.734 0 1.334.573 1.334 1.273z",fill:"#C4C9CF"}))},M=["styles"],F=function(e){e.styles;var n=g(e,M);return t.createElement("svg",v({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),t.createElement("path",{d:"M18.79 13.71a.937.937 0 010 1.329l-1.876 1.875a.945.945 0 01-1.532-.305.938.938 0 01.204-1.023l.273-.274h-2.414a1.571 1.571 0 01-1.273-.656L6.39 6.562H2.5a.938.938 0 110-1.875h4.055a1.57 1.57 0 011.273.656l5.781 8.094h2.25l-.273-.273a.94.94 0 011.328-1.328l1.875 1.875zM8.624 11.922a.938.938 0 00-1.305.22l-.93 1.296H2.5a.937.937 0 100 1.875h4.055a1.571 1.571 0 001.273-.656l1.016-1.422a.945.945 0 00-.219-1.313zm2.75-3.843a.937.937 0 001.305-.219l.93-1.297h2.25l-.274.274a.937.937 0 00.664 1.6.946.946 0 00.664-.272l1.875-1.875a.937.937 0 000-1.328l-1.875-1.875a.94.94 0 00-1.328 1.328l.273.273h-2.414a1.57 1.57 0 00-1.273.656l-1.016 1.422a.945.945 0 00.219 1.313z",fill:"#C4C9CF"}))},H=["styles"],D=function(e){e.styles;var n=g(e,H);return t.createElement("svg",v({width:"40",height:"40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),t.createElement("path",{d:"M8.333 31.394V8.606a1.667 1.667 0 012.449-1.472L32.23 18.528c1.18.627 1.18 2.317 0 2.944L10.782 32.866a1.667 1.667 0 01-2.449-1.472z",fill:"#fff"}))},z=["styles"],Y=function(e){e.styles;var n=g(e,z);return t.createElement("svg",v({width:"40",height:"40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),t.createElement("path",{d:"M10 10c0-.92.746-1.666 1.667-1.666H15c.92 0 1.667.746 1.667 1.667v20c0 .92-.747 1.666-1.667 1.666h-3.333c-.92 0-1.667-.746-1.667-1.666V10zm13.333 0c0-.92.747-1.666 1.667-1.666h3.333c.92 0 1.667.746 1.667 1.667v20c0 .92-.746 1.666-1.667 1.666H25c-.92 0-1.667-.746-1.667-1.666V10z",fill:"#fff"}))},B=e.useRef,I=e.useCallback,G=e.useEffect;function V(t){var n,r=t.audioRef,a=t.progressBarRef,l=t.duration,o=t.setTimeProgress,i=t.setLoop,c=t.loop;t.dispatch;var u,s=t.playlist,m=t.mobileExpanded,f=void 0!==m&&m,p=B(),d="undefined"!=typeof window&&null!==(u=window.__CHEST_PLAYER_DEPS__)&&void 0!==u&&u.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{play:function(){return console.log("Play action not injected")},next:function(){return console.log("Next action not injected")},previous:function(){return console.log("Previous action not injected")},playing:function(){return console.log("Playing action not injected")}},v=d.play,y=d.next,g=d.previous,E=d.playing,w=I(function(){if(r.current){var e=r.current.currentTime,t=r.current.duration;o(e),a.current.value=e,a.current.style.setProperty("--range-progress","".concat(a.current.value/t*100,"%")),p.current=requestAnimationFrame(w)}},[r,l,a,o]),b=function(){v()};G(function(){var e=function(e){32===e.keyCode&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),v())};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}},[v]);var x,_=function(){i(function(e){return!e})},P=function(){var e;null!==(e=s[0])&&void 0!==e&&e.token||y()},N=function(){var e;null!==(e=s[0])&&void 0!==e&&e.token||g()},k=function(){var e;if(null===(e=s[0])||void 0===e||!e.token)if(s.length>1)y();else{r.current&&(r.current.currentTime=0);var t=s[0];E(h(h({},t),{},{isPlaying:!1}))}};return G(function(){return r.current&&r.current.addEventListener("ended",k),function(){r.current&&r.current.removeEventListener("ended",k)}},[r.current,s]),G(function(){var e;if(null!==(e=s[0])&&void 0!==e&&e.isPlaying){var t=r.current.play();void 0!==t&&t.catch(function(){r.current.pause()})}else r.current.pause();r.current.loop=!!c,p.current=requestAnimationFrame(w)},[c,r,w,s]),f?e.createElement("div",{className:"w-full px-4 flex items-center justify-between"},e.createElement("button",{type:"button",className:"opacity-30",disabled:!0},e.createElement(F,{width:20,height:20})),e.createElement("div",{className:"flex items-center gap-6"},e.createElement("button",{type:"button",onClick:N,className:"text-neutral-silver-200 hover:text-white"},e.createElement(L,{width:24,height:24})),e.createElement("button",{type:"button",onClick:b,className:"text-white hover:scale-105 transition-transform"},null!==(x=s[0])&&void 0!==x&&x.isPlaying?e.createElement(Y,{width:34,height:34}):e.createElement(D,{width:34,height:34})),e.createElement("button",{type:"button",onClick:P,className:"text-neutral-silver-200 hover:text-white"},e.createElement(R,{width:24,height:24}))),e.createElement("button",{type:"button",className:"".concat(c?"text-white":"text-neutral-silver-200 hover:text-white"),onClick:_},e.createElement(T,{width:20,height:20}))):e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center"},e.createElement("button",{type:"button",className:"p-2 mr-2 disabled:opacity-30",disabled:!0},e.createElement(F,null)),e.createElement("button",{type:"button",onClick:N,className:"p-2 player-controls"},e.createElement(L,null)),e.createElement("button",{type:"button",onClick:b,className:"player-controls"},null!==(n=s[0])&&void 0!==n&&n.isPlaying?e.createElement(Y,{width:40,height:40}):e.createElement(D,{width:40,height:40})),e.createElement("button",{type:"button",onClick:P,className:"p-2 player-controls"},e.createElement(R,null)),e.createElement("button",{type:"button",className:"p-2 ml-2 ".concat(c?"player-controls-active":"player-controls"),onClick:_},e.createElement(T,null))))}var q=e.useRef,U=e.useCallback,X=e.useEffect;function Q(t){var n,r,a,l=t.audioRef,o=t.progressBarRef;t.duration;var i=t.setTimeProgress;t.setLoop,t.loop,t.dispatch;var c,u=t.playlist,s=q(),m="undefined"!=typeof window&&null!==(c=window.__CHEST_PLAYER_DEPS__)&&void 0!==c&&c.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{play:function(){},playing:function(){}},f=m.play;m.playing;var p=U(function(){if(l.current&&o.current)try{var e=l.current.currentTime,t=l.current.duration;i(e),o.current.value=e,o.current.style.setProperty("--range-progress","".concat(o.current.value/t*100,"%")),s.current=requestAnimationFrame(p)}catch(e){cancelAnimationFrame(s.current)}},[l,o,i]);return X(function(){var e;if(null!==(e=l.current)&&void 0!==e&&e.src)return s.current=requestAnimationFrame(p),function(){s.current&&cancelAnimationFrame(s.current)}},[p,null===(n=l.current)||void 0===n?void 0:n.src]),X(function(){var e,t;if(null!==(e=u[0])&&void 0!==e&&e.isPlaying&&l.current){var n=l.current.play();void 0!==n&&n.catch(function(){l.current.pause()})}else null!==(t=u[0])&&void 0!==t&&t.isPlaying||!l.current||l.current.pause();s.current=requestAnimationFrame(p)},[null===(r=u[0])||void 0===r?void 0:r.isPlaying,l,p]),e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center"},e.createElement("button",{type:"button",onClick:function(e){e.stopPropagation(),f()},className:"player-controls"},null!==(a=u[0])&&void 0!==a&&a.isPlaying?e.createElement(Y,{width:40,height:40}):e.createElement(D,{width:40,height:40}))))}var $=e.useEffect,J=e.useRef,K=e.useState;function W(t){var n=t.audioRef;t.dispatch;var r,a=b(K(50),2),l=a[0],o=a[1],i=b(K(0),2),f=i[0],p=i[1],d=("undefined"!=typeof window&&null!==(r=window.__CHEST_PLAYER_DEPS__)&&void 0!==r&&r.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{reset:function(){return console.log("Reset action not injected")}}).reset,v=J();return $(function(){v.current.style.setProperty("--range-progress","".concat(v.current.value,"%")),n&&(n.current.volume=l/100)},[l,n]),e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center justify-end player-volume"},e.createElement("button",{type:"button",className:"p-2 disabled:opacity-30",disabled:!0},e.createElement(c,{className:"h-6 w-6 text-neutral-silver-200"})),e.createElement("button",{type:"button",className:"p-2",onClick:function(){l>0?(p(l),o(0)):o(f)}},0===l?e.createElement(u,{className:"h-6 w-6 text-neutral-silver-200"}):e.createElement(s,{className:"h-6 w-6 text-neutral-silver-200"})),e.createElement("input",{ref:v,type:"range",value:l,min:0,max:100,className:"bg-neutral-black rounded-lg h-1.5 appearance-none mr-4",onChange:function(e){o(parseInt(e.target.value))}}),e.createElement("button",{type:"button",className:"p-2 test",onClick:function(){d()}},e.createElement(m,{className:"h-6 w-6 text-white"}))))}var Z=e.useCallback;function ee(t){var n,r=t.currentTrack;t.audioRef,t.setDuration,t.progressBarRef;var a=t.dispatch,l=!(null===(n=t.playlist[0])||void 0===n||!n.token),o=Z(function(){r&&a(void h(h({},r),{},{isPlaying:!r.isPlaying}))},[r,a]);return e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"flex gap-4 items-center"},e.createElement("div",{className:"w-[52px] h-[52px] bg-cover rounded cursor-pointer",style:{backgroundImage:"url(".concat(r.cover_url||"https://cdn.chestmusic.com/cover-default.jpg",")")},onClick:o}),e.createElement("div",{className:"flex flex-col gap-0.5"},e.createElement("div",{className:"flex flex-col grow"},e.createElement("div",{className:"w-full whitespace-nowrap overflow-hidden relative"},e.createElement("span",{className:"text-sm text-white inline-block"},r.name)),e.createElement("span",{className:"text-sm text-neutral-silver-200"},r.authors),l&&r.play_limit>0&&e.createElement("span",{className:"text-xs text-neutral-silver-300"},r.play_limit-r.plays," reproducciones restantes")))))}function te(t){var n,r,a=t.currentTrack;t.audioRef,t.setDuration,t.progressBarRef;var l=t.open;return e.createElement(e.Fragment,null,l?e.createElement("div",null,e.createElement("div",null,e.createElement("div",{className:"flex gap-3 items-center justify-center -mb-2"},e.createElement("div",{className:"w-[286px] h-[286px] bg-cover rounded",style:{backgroundImage:"url(".concat(a.cover_url,")")}})),e.createElement("div",{className:"rounded-3xl px-5 pt-2 backdrop-blur-xl flex flex-col gap-1 items-center justify-center h-[160px]",style:{background:"rgba(67, 71, 79, 0.30)"}},e.createElement("span",{className:"font-thunder-bold text-4xl uppercase !text-center"},a.name),e.createElement("span",{className:"text-neutral-silver-200"},null==a||null===(n=a.authors)||void 0===n?void 0:n.join(", "))))):e.createElement("div",{className:"flex items-center grow min-w-0"},e.createElement("div",{className:"flex gap-3 items-center min-w-0 flex-1"},e.createElement("div",{className:"w-10 h-10 bg-cover rounded min-w-[40px] flex-shrink-0",style:{backgroundImage:"url(".concat(a.cover_url||"https://cdn.chestmusic.com/cover-default.jpg",")")}}),e.createElement("div",{className:"flex flex-col min-w-0 flex-1"},e.createElement("div",{className:"w-full truncate"},e.createElement("span",{className:"text-sm text-white truncate"},a.name)),e.createElement("span",{className:"text-sm text-neutral-silver-200 truncate"},null==a||null===(r=a.authors)||void 0===r?void 0:r.join(", "))))))}var ne=e.useEffect,re=e.useRef,ae=e.useState,le=e.useCallback;function oe(){var t,n,r,a,o,i,c=function(){if("undefined"!=typeof window&&window.__CHEST_PLAYER_DEPS__)return window.__CHEST_PLAYER_DEPS__;throw new Error("ChestPlayer: Dependencies not provided. Make sure to use PlayerProvider.")}(),u=c.apiHooks,s=u.useLazyGetTrackSourceQuery,m=u.useUpdateTrackPlayMutation,f=c.playlistActions,d=f.reset,v=f.play,y=c.playerActions,h=y.closePlayer,g=y.openPlayer,w=c.reduxProps,N=w.dispatch,k=w.playlist;w.playerState;var j=b(ae(!1),2);j[0];var T=j[1],O=b(s(),2),R=O[0],A=O[1],L=b(m(),2),M=L[0];L[1];var F=P("PlayLimitModal").onOpen,H=_("(max-width: 768px)"),D=b(ae(!1),2),z=D[0],Y=D[1],B=b(ae(0),2),I=B[0],G=B[1],q=b(ae(0),2),U=q[0],X=q[1],$=b(ae(),2),J=$[0],K=$[1],Z=b(ae(!1),2),oe=Z[0],ie=Z[1],ce=b(ae(),2),ue=ce[0],se=ce[1],me=b(ae(0),2),fe=me[0],pe=me[1],de=b(ae(null),2),ve=de[0],ye=de[1],he=b(ae(!1),2);he[0];var ge=he[1],Ee=b(ae(!1),2),we=Ee[0],be=Ee[1],xe=b(ae(!1),2),_e=xe[0],Pe=xe[1],Ne=b(ae(0),2),ke=Ne[0],Ce=Ne[1],Se=b(ae(!1),2),je=Se[0],Te=Se[1],Oe=b(ae(0),2);Oe[0];var Re=Oe[1],Ae=re(),Le=re(),Me=re(),Fe=!(null===(t=k[0])||void 0===t||!t.token),He=b(ae(null),2);He[0],He[1];var De=b(ae(!1),2);De[0],De[1];var ze=b(ae(0),2);ze[0];var Ye=ze[1],Be=b(ae(!1),2);Be[0];var Ie=Be[1],Ge=b(ae(0),2),Ve=Ge[0],qe=Ge[1],Ue=b(ae(!1),2),Xe=Ue[0],Qe=Ue[1],$e=re();ne(function(){N(oe?g():h())},[oe]),ne(function(){d()},[]),ne(function(){var e=J,t=k&&k[0];if(t){if("object"===x(e)&&e.id===t.id)return;if(T(!1),pe(t.plays||0),ye(t.play_limit||null),Pe(!1),t.audio)K({url:t.audio,cover_url:t.cover||"https://cdn.chestmusic.com/cover-default.jpg",name:t.name,authors:t.authors,type:t.type,id:t.id,plays:t.plays,play_limit:t.play_limit});else{var n=localStorage.getItem("chestmusic_session_id");R({id:t.id,session:n}).then(function(e){var n=e.data;n&&K({url:n.url,cover_url:t.cover||"https://cdn.chestmusic.com/cover-default.jpg",name:t.name,authors:t.authors,type:t.type,id:t.id,plays:t.plays,play_limit:t.play_limit})})}}},[k,A]),ne(function(){J?ue!==J.id&&se(J.id):se("")},[J]),le(function(){var e;if(Fe&&null!=J&&J.id&&null!==(e=k[0])&&void 0!==e&&e.token){var t="plays_".concat(J.id,"_").concat(k[0].token),n=localStorage.getItem(t);return n?parseInt(n):0}return 0},[Fe,null==J?void 0:J.id,null===(n=k[0])||void 0===n?void 0:n.token]),ne(function(){var e,t;Fe&&null!=J&&J.id&&null!==(e=k[0])&&void 0!==e&&e.token&&(pe(J.plays||0),(J.plays||0)>((null===(t=k[0])||void 0===t?void 0:t.play_limit)||0)&&(be(!0),Ae.current&&Ae.current.pause()))},[Fe,null==J?void 0:J.id,null===(r=k[0])||void 0===r?void 0:r.token,null==J?void 0:J.plays]);var Je=function(){if(Fe){var e,t,n=null===(e=k[0])||void 0===e?void 0:e.play_limit;if(n)if(fe>n||fe>=n&&_e)return null===(t=Ae.current)||void 0===t||t.pause(),F(),!1}return!0},Ke=function(){var e,t=(e=E().m(function e(){var t;return E().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!Fe||we){e.n=4;break}return e.p=1,e.n=2,M({id:J.id,anonymous:!0,token:k[0].token});case 2:pe(t=fe+1),t>ve&&(be(!0),F(),Ae.current&&Ae.current.pause()),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[1,3]])}),function(){var t=this,n=arguments;return new Promise(function(r,a){var l=e.apply(t,n);function o(e){p(l,r,a,o,i,"next",e)}function i(e){p(l,r,a,o,i,"throw",e)}o(void 0)})});return function(){return t.apply(this,arguments)}}();return ne(function(){var e;if(J&&null!==(e=k[0])&&void 0!==e&&e.isPlaying){if(!Je())return void N(v());if(Ae.current){var t=Ae.current.play();void 0!==t&&t.catch(function(e){})}}},[J,null===(a=k[0])||void 0===a?void 0:a.isPlaying]),ne(function(){var e;(null===(e=k[0])||void 0===e?void 0:e.id)!==ue&&(ge(!1),Ie(!1),Ye(0),Pe(!1))},[null===(o=k[0])||void 0===o?void 0:o.id]),e.createElement(e.Fragment,null,J&&k.length>0&&e.createElement(e.Fragment,null,e.createElement("audio",{src:J.url,ref:Ae,onLoadedMetadata:function(){var e=Ae.current.duration;X(e),Le.current&&(Le.current.max=e)},onEnded:function(){ge(!0),Ie(!1),Ye(0),Pe(!1)},onTimeUpdate:function(){if(Ae.current){var e=Ae.current.currentTime;e>.15*U&&Ie(!0),Ye(e),G(e)}},onPlay:function(){var e,t;Je()?((null===(e=Ae.current)||void 0===e?void 0:e.currentTime)||0)<.15*U&&!_e&&(Ie(!1),Ke(),Pe(!0)):null===(t=Ae.current)||void 0===t||t.pause()}}),Fe&&null!==ve&&ve>0&&e.createElement("div",{className:"fixed bottom-[102px] right-0 left-0 inset-x-0 max-w-max mx-auto z-50"},e.createElement(l.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},className:"px-6 py-3 bg-neutral-silver-600 rounded-t-xl"},e.createElement("span",{className:"text-brand-gold"},Math.max(0,ve-fe))," of ",ve," plays remaining")),H?e.createElement(e.Fragment,null,e.createElement("div",{className:"".concat(oe?"audio-player-mobile-open relative z-50":"audio-player-mobile")},oe?e.createElement("div",{ref:$e,className:"bg-black bg-opacity-60 backdrop-blur-md rounded-2xl flex flex-col w-full",onTouchStart:function(e){qe(e.touches[0].clientY),Qe(!0),$e.current&&($e.current.style.transition="none")},onTouchMove:function(e){if(Ve&&Xe){var t=e.touches[0].clientY,n=Ve-t;n>0&&$e.current&&($e.current.style.transform="translateY(-".concat(n,"px)"),$e.current.style.opacity=Math.max(.3,1-n/300))}},onTouchEnd:function(e){if(Ve&&Xe){var t=e.changedTouches[0].clientY,n=Ve-t;$e.current&&($e.current.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",n>150?($e.current.style.transform="translateY(-100vh)",$e.current.style.opacity="0",setTimeout(function(){ie(!1),$e.current&&($e.current.style.transform="translateY(0)",$e.current.style.opacity="1",$e.current.style.transition="")},300)):($e.current.style.transform="translateY(0)",$e.current.style.opacity="1",setTimeout(function(){$e.current&&($e.current.style.transition="")},300))),qe(0),Qe(!1)}}},e.createElement("div",{className:"flex flex-col items-center justify-center px-6 py-8"},e.createElement("div",{className:"text-center mb-4"},e.createElement("span",{className:"font-thunder-bold text-white text-center block",style:{fontSize:"32px",lineHeight:"1.1"}},J.name)),e.createElement("div",{className:"text-center mb-8"},e.createElement("span",{className:"text-neutral-silver-200",style:{fontSize:"16px"}},null==J||null===(i=J.authors)||void 0===i?void 0:i.join(", "))),e.createElement("div",{className:"mb-8 w-full px-4"},e.createElement("div",{className:"w-full aspect-square bg-cover shadow-2xl max-w-sm mx-auto",style:{backgroundImage:"url(".concat(J.cover_url||"https://cdn.chestmusic.com/cover-default.jpg",")"),borderRadius:"11px"}})),e.createElement("div",{className:"w-full px-4 mb-4"},e.createElement(S,{progressBarRef:Le,audioRef:Ae,timeProgress:I,duration:U,open:oe,playlist:k})),e.createElement(V,{audioRef:Ae,progressBarRef:Le,duration:U,setTimeProgress:G,setLoop:Y,loop:z,dispatch:N,playlist:k,mobileExpanded:!0}))):e.createElement("div",{ref:Me,className:"flex flex-row min-w-0 w-full ".concat(je?"swiping":""),onClick:function(){ie(function(e){return!e})},onTouchStart:function(e){Ce(e.touches[0].clientX),Te(!1),Re(0)},onTouchMove:function(e){if(ke){var t=e.touches[0].clientX-ke;Te(!0),Re(t),Me.current&&Me.current.style.setProperty("--swipe-distance","".concat(t,"px"))}},onTouchEnd:function(e){if(ke){var t=e.changedTouches[0].clientX,n=Math.abs(ke-t);Te(!1),Re(0),Me.current&&Me.current.style.setProperty("--swipe-distance","0px"),n>100&&N(h()),Ce(0)}}},e.createElement(te,{currentTrack:J,audioRef:Ae,setDuration:X,progressBarRef:Le,dispatch:N,playlist:k}),e.createElement(Q,{audioRef:Ae,progressBarRef:Le,duration:U,setTimeProgress:G,setLoop:Y,loop:z,dispatch:N,playlist:k})))):e.createElement(l.div,{className:"audio-player",initial:{height:0},animate:{height:"auto"},exit:{height:0,transition:{delay:.7,duration:1,ease:"easeIn"}}},e.createElement(ee,{currentTrack:J,audioRef:Ae,setDuration:X,progressBarRef:Le,dispatch:N,playlist:k}),e.createElement("div",{className:"grow flex flex-col items-center justify-center gap-1.5"},e.createElement(V,{audioRef:Ae,progressBarRef:Le,duration:U,setTimeProgress:G,setLoop:Y,loop:z,dispatch:N,playlist:k}),e.createElement(C,{progressBarRef:Le,audioRef:Ae,timeProgress:I,duration:U,playlist:k})),e.createElement(W,{audioRef:Ae,dispatch:N}))))}var ie=["apiHooks","playlistActions","playerActions","reduxProps"],ce=function(t){var n=t.apiHooks,r=t.playlistActions,a=t.playerActions,l=t.reduxProps,o=g(t,ie);return"undefined"!=typeof window&&(window.__CHEST_PLAYER_DEPS__={apiHooks:n,playlistActions:r,playerActions:a,reduxProps:l}),e.createElement(oe,o)};export{V as Controls,Q as ControlsMobile,oe as Player,ce as PlayerProvider,C as ProgressBar,S as ProgressBarMobile,ee as Track,te as TrackMobile,W as VolumeControls,_ as useMediaQuery,P as useModal};
//# sourceMappingURL=index.esm.js.map
