"use strict";var e=require("react"),t=require("framer-motion"),r=require("react-redux"),n=require("@heroicons/react/24/outline");function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t,r,n,a,l,o){try{var i=e[l](o),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i.apply(null,arguments)}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){o(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function f(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function l(r,n,a,l){var c=n&&n.prototype instanceof i?n:i,u=Object.create(c.prototype);return p(u,"_invoke",function(r,n,a){var l,i,c,u=0,s=a||[],f=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,r){return l=t,i=0,c=e,p.n=r,o}};function m(r,n){for(i=r,c=n,t=0;!f&&u&&!a&&t<s.length;t++){var a,l=s[t],m=p.p,d=l[2];r>3?(a=d===n)&&(c=l[(i=l[4])?5:(i=3,3)],l[4]=l[5]=e):l[0]<=m&&((a=r<2&&m<l[1])?(i=0,p.v=n,p.n=l[1]):m<d&&(a=r<3||l[0]>n||n>d)&&(l[4]=r,l[5]=n,p.n=d,i=0))}if(a||r>1)return o;throw f=!0,n}return function(a,s,d){if(u>1)throw TypeError("Generator is already running");for(f&&1===s&&m(s,d),i=s,c=d;(t=i<2?e:c)||!f;){l||(i?i<3?(i>1&&(p.n=-1),m(i,c)):p.n=c:p.v=c);try{if(u=2,l){if(i||(a="next"),t=l[a]){if(!(t=t.call(l,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=l.return)&&t.call(l),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);l=e}else if((t=(f=p.n<0)?c:r.call(n,p))!==o)break}catch(t){l=e,i=1,c=t}finally{u=1}}return{value:t,done:f}}}(r,a,l),!0),u}var o={};function i(){}function c(){}function u(){}t=Object.getPrototypeOf;var s=[][n]?t(t([][n]())):(p(t={},n,function(){return this}),t),m=u.prototype=i.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,p(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return c.prototype=u,p(m,"constructor",u),p(u,"constructor",c),c.displayName="GeneratorFunction",p(u,a,"GeneratorFunction"),p(m),p(m,a,"Generator"),p(m,n,function(){return this}),p(m,"toString",function(){return"[object Generator]"}),(f=function(){return{w:l,m:d}})()}function p(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}p=function(e,t,r,n){if(t)a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{function l(t,r){p(e,t,function(e){return this._invoke(t,r,e)})}l("next",0),l("throw",1),l("return",2)}},p(e,t,r,n)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,l,o,i=[],c=!0,u=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}var v=function(t){var r=m(e.useState(!1),2),n=r[0],a=r[1];return e.useEffect(function(){var e=window.matchMedia(t);e.matches!==n&&a(e.matches);var r=function(){return a(e.matches)};return window.addEventListener("resize",r),function(){return window.removeEventListener("resize",r)}},[n,t]),n};function y(t){var n,a=r.useDispatch(),l="undefined"!=typeof window&&null!==(n=window.__CHEST_PLAYER_DEPS__)&&void 0!==n&&n.modalActions?window.__CHEST_PLAYER_DEPS__.modalActions:{openModal:function(){},closeModal:function(){},isModalOpen:function(){return!1}},o=l.openModal,i=l.closeModal,c=l.isModalOpen,u=e.useCallback(function(e){return a(o(t,e))},[a,o,t]),s=e.useCallback(function(){return a(i(t))},[a,i,t]);return{isOpen:r.useSelector(function(e){return c(e,t)}),onOpen:u,onClose:s}}function g(e){if(isNaN(e))return"0:00";var t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?"".concat(t,":").concat(r.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")):"".concat(r,":").concat(n.toString().padStart(2,"0"))}function h(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ")}function E(e){var t,r=e.timeProgress,n=e.duration,a=e.progressBarRef,l=e.audioRef;e.open;var o=!(null===(t=e.playlist[0])||void 0===t||!t.token);return React.createElement(React.Fragment,null,React.createElement("div",{className:"w-full flex items-center gap-1.5 player-progressbar"},React.createElement("div",{className:"text-sm"},g.time(r)),React.createElement("input",{type:"range",defaultValue:0,step:.05,className:"bg-neutral-black rounded-lg h-1.5 accent-white appearance-none ".concat(o?"pointer-events-none":""),ref:a,onChange:function(){o||(l.current.currentTime=a.current.value)}}),React.createElement("div",{className:"text-sm"},g.time(n))))}function w(e){var t,r=e.timeProgress,n=e.duration,a=e.progressBarRef,l=e.audioRef,o=e.open,i=!(null===(t=e.playlist[0])||void 0===t||!t.token);return React.createElement(React.Fragment,null,React.createElement("div",{className:h({"w-full flex items-center player-progressbar":!0,"flex-col gap-2":o,"gap-1.5":!o})},o&&React.createElement("div",{className:"grid grid-cols-2 w-full"},React.createElement("div",{className:"text-sm"},g.time(r)),React.createElement("div",{className:"text-sm text-right text-neutral-silver-200"},g.time(n))),React.createElement("input",{type:"range",defaultValue:0,step:.05,className:h({"bg-neutral-black rounded-lg accent-white appearance-none":!0,"h-1.5":o,"h-[3px]":!o,"pointer-events-none":i}),ref:a,onChange:function(){i||(l.current.currentTime=a.current.value)}})))}var b=["styles"],x=function(t){t.styles;var r=s(t,b);return e.createElement("svg",i({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M1.668 10.001a5.776 5.776 0 011.634-4.028 5.513 5.513 0 013.936-1.672h7.255l-.257-.262a.902.902 0 01-.258-.637.92.92 0 01.258-.638.88.88 0 01.623-.264.863.863 0 01.623.264l1.759 1.8a.901.901 0 01.258.637.918.918 0 01-.258.638l-1.76 1.8a.876.876 0 01-1.245 0A.901.901 0 0113.977 7a.918.918 0 01.26-.637l.256-.263H7.238c-1.011 0-1.98.411-2.695 1.143A3.947 3.947 0 003.427 10a.91.91 0 01-.258.637.87.87 0 01-1.243 0A.91.91 0 011.668 10zm14.95-.9a.87.87 0 00-.622.264.91.91 0 00-.258.636 3.98 3.98 0 01-.29 1.493 3.907 3.907 0 01-.826 1.265c-.354.362-.774.65-1.236.845a3.735 3.735 0 01-1.458.297H4.673l.256-.262a.912.912 0 000-1.275.87.87 0 00-1.246 0l-1.758 1.8a.902.902 0 00-.259.637.918.918 0 00.259.637l1.758 1.8a.877.877 0 001.246 0 .901.901 0 00.259-.637.918.918 0 00-.259-.638l-.256-.262h7.255a5.513 5.513 0 003.936-1.672 5.776 5.776 0 001.633-4.028.91.91 0 00-.257-.636.87.87 0 00-.622-.264z",fill:"#C4C9CF"}))},P=["styles"],_=function(t){t.styles;var r=s(t,P);return e.createElement("svg",i({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M6.107 18.224l7.693-5.18a1.24 1.24 0 000-2.075L6.107 5.776C5.213 5.191 4 5.79 4 6.82v10.36c0 1.03 1.213 1.63 2.107 1.044zM17.333 6.273v11.454c0 .7.6 1.273 1.334 1.273C19.4 19 20 18.427 20 17.727V6.273C20 5.573 19.4 5 18.667 5c-.734 0-1.334.573-1.334 1.273z",fill:"#C4C9CF"}))},R=["styles"],S=function(t){t.styles;var r=s(t,R);return e.createElement("svg",i({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M17.893 18.224l-7.693-5.18a1.24 1.24 0 010-2.075l7.693-5.193C18.787 5.191 20 5.79 20 6.82v10.36c0 1.03-1.213 1.63-2.107 1.044zM6.667 6.273v11.454c0 .7-.6 1.273-1.334 1.273C4.6 19 4 18.427 4 17.727V6.273C4 5.573 4.6 5 5.333 5c.734 0 1.334.573 1.334 1.273z",fill:"#C4C9CF"}))},k=["styles"],N=function(t){t.styles;var r=s(t,k);return e.createElement("svg",i({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M18.79 13.71a.937.937 0 010 1.329l-1.876 1.875a.945.945 0 01-1.532-.305.938.938 0 01.204-1.023l.273-.274h-2.414a1.571 1.571 0 01-1.273-.656L6.39 6.562H2.5a.938.938 0 110-1.875h4.055a1.57 1.57 0 011.273.656l5.781 8.094h2.25l-.273-.273a.94.94 0 011.328-1.328l1.875 1.875zM8.624 11.922a.938.938 0 00-1.305.22l-.93 1.296H2.5a.937.937 0 100 1.875h4.055a1.571 1.571 0 001.273-.656l1.016-1.422a.945.945 0 00-.219-1.313zm2.75-3.843a.937.937 0 001.305-.219l.93-1.297h2.25l-.274.274a.937.937 0 00.664 1.6.946.946 0 00.664-.272l1.875-1.875a.937.937 0 000-1.328l-1.875-1.875a.94.94 0 00-1.328 1.328l.273.273h-2.414a1.57 1.57 0 00-1.273.656l-1.016 1.422a.945.945 0 00.219 1.313z",fill:"#C4C9CF"}))},C=["styles"],O=function(t){t.styles;var r=s(t,C);return e.createElement("svg",i({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M5 18.836V5.163a1 1 0 011.47-.883l12.868 6.837a1 1 0 010 1.766L6.469 19.719A1 1 0 015 18.836z",fill:"#fff"}))},j=["styles"],A=function(t){t.styles;var r=s(t,j);return e.createElement("svg",i({width:"40",height:"40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),e.createElement("path",{d:"M10 10c0-.92.746-1.666 1.667-1.666H15c.92 0 1.667.746 1.667 1.667v20c0 .92-.747 1.666-1.667 1.666h-3.333c-.92 0-1.667-.746-1.667-1.666V10zm13.333 0c0-.92.747-1.666 1.667-1.666h3.333c.92 0 1.667.746 1.667 1.667v20c0 .92-.746 1.666-1.667 1.666H25c-.92 0-1.667-.746-1.667-1.666V10z",fill:"#fff"}))};function T(t){var r,n,a=t.audioRef,l=t.progressBarRef,o=t.duration,i=t.setTimeProgress,c=t.setLoop,s=t.loop,f=t.dispatch,p=t.playlist,m=e.useRef(),d="undefined"!=typeof window&&null!==(n=window.__CHEST_PLAYER_DEPS__)&&void 0!==n&&n.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{play:function(){},next:function(){},previous:function(){},playing:function(){}},v=d.play,y=d.next,g=d.previous,h=e.useCallback(function(){if(a.current){var e=a.current.currentTime,t=a.current.duration;i(e),l.current.value=e,l.current.style.setProperty("--range-progress","".concat(l.current.value/t*100,"%")),m.current=requestAnimationFrame(h)}},[a,o,l,i]);e.useEffect(function(){var e=function(e){32===e.keyCode&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),f(v()))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}},[f]);var E=function(){var e;if(null===(e=p[0])||void 0===e||!e.token)if(p.length>1)f(y());else{a.current&&(a.current.currentTime=0);var t=p[0];f(playing(u(u({},t),{},{isPlaying:!1})))}};return e.useEffect(function(){return a.current&&a.current.addEventListener("ended",E),function(){a.current&&a.current.removeEventListener("ended",E)}},[a.current,p]),e.useEffect(function(){var e;if(null!==(e=p[0])&&void 0!==e&&e.isPlaying){var t=a.current.play();void 0!==t&&t.catch(function(e){console.log(e),a.current.pause()})}else a.current.pause();a.current.loop=!!s,m.current=requestAnimationFrame(h)},[s,a,h,p]),e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center"},e.createElement("button",{type:"button",className:"p-2 mr-2 disabled:opacity-30",disabled:!0},e.createElement(N,null)),e.createElement("button",{type:"button",onClick:function(){var e;null!==(e=p[0])&&void 0!==e&&e.token||f(g())},className:"p-2 player-controls"},e.createElement(S,null)),e.createElement("button",{type:"button",onClick:function(){f(v())},className:"player-controls"},null!==(r=p[0])&&void 0!==r&&r.isPlaying?e.createElement(A,{width:40,height:40}):e.createElement(O,{width:40,height:40})),e.createElement("button",{type:"button",onClick:function(){var e;null!==(e=p[0])&&void 0!==e&&e.token||f(y())},className:"p-2 player-controls"},e.createElement(_,null)),e.createElement("button",{type:"button",className:"p-2 ml-2 ".concat(s?"player-controls-active":"player-controls"),onClick:function(){c(function(e){return!e})}},e.createElement(x,null))))}function M(t){var r,n,a=t.audioRef,l=t.progressBarRef;t.duration;var o=t.setTimeProgress;t.setLoop,t.loop;var i,c=t.dispatch,u=t.playlist,s=e.useRef(),f=("undefined"!=typeof window&&null!==(i=window.__CHEST_PLAYER_DEPS__)&&void 0!==i&&i.playlistActions?window.__CHEST_PLAYER_DEPS__.playlistActions:{play:function(){}}).play,p=e.useCallback(function(){if(a.current&&l.current)try{var e=a.current.currentTime,t=a.current.duration;o(e),l.current.value=e,l.current.style.setProperty("--range-progress","".concat(l.current.value/t*100,"%")),s.current=requestAnimationFrame(p)}catch(e){console.error("Error in repeat:",e),cancelAnimationFrame(s.current)}},[a,l,o]);return e.useEffect(function(){var e;if(null!==(e=a.current)&&void 0!==e&&e.src)return s.current=requestAnimationFrame(p),function(){s.current&&cancelAnimationFrame(s.current)}},[p,null===(r=a.current)||void 0===r?void 0:r.src]),e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center"},e.createElement("button",{type:"button",onClick:function(e){var t;e.stopPropagation(),null!==(t=a.current)&&void 0!==t&&t.src&&c(f())},className:"player-controls"},null!==(n=u[0])&&void 0!==n&&n.isPlaying?e.createElement(A,{width:40,height:40}):e.createElement(O,{width:40,height:40}))))}function L(t){var r=t.audioRef,a=t.dispatch,l=m(e.useState(50),2),o=l[0],i=l[1],c=m(e.useState(0),2),u=c[0],s=c[1],f=e.useRef();return e.useEffect(function(){f.current.style.setProperty("--range-progress","".concat(f.current.value,"%")),r&&(r.current.volume=o/100)},[o,r]),e.createElement(e.Fragment,null,e.createElement("div",{className:"flex items-center justify-end player-volume"},e.createElement("button",{type:"button",className:"p-2 disabled:opacity-30",disabled:!0},e.createElement(n.ClockIcon,{className:"h-6 w-6 text-neutral-silver-200"})),e.createElement("button",{type:"button",className:"p-2",onClick:function(){o>0?(s(o),i(0)):i(u)}},0===o?e.createElement(n.SpeakerXMarkIcon,{className:"h-6 w-6 text-neutral-silver-200"}):e.createElement(n.SpeakerWaveIcon,{className:"h-6 w-6 text-neutral-silver-200"})),e.createElement("input",{ref:f,type:"range",value:o,min:0,max:100,className:"bg-neutral-black rounded-lg h-1.5 accent-white appearance-none mr-4",onChange:function(e){i(parseInt(e.target.value))}}),e.createElement("button",{type:"button",className:"p-2 test",onClick:function(){a(void 0)}},e.createElement(n.ChevronDownIcon,{className:"h-6 w-6 text-white"}))))}function D(t){var r,n=t.currentTrack;t.audioRef,t.setDuration,t.progressBarRef;var a=t.dispatch,l=!(null===(r=t.playlist[0])||void 0===r||!r.token),o=e.useCallback(function(){n&&a(void u(u({},n),{},{isPlaying:!n.isPlaying}))},[n,a]);return e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"flex gap-4 items-center"},e.createElement("div",{className:"w-[52px] h-[52px] bg-cover rounded cursor-pointer",style:{backgroundImage:"url(".concat(n.cover_url||"https://cdn.chestmusic.com/cover-default.jpg",")")},onClick:o}),e.createElement("div",{className:"flex flex-col gap-0.5"},e.createElement("div",{className:"flex flex-col grow"},e.createElement("div",{className:"w-full whitespace-nowrap overflow-hidden relative"},e.createElement("span",{className:"text-sm text-white inline-block"},n.name)),e.createElement("span",{className:"text-sm text-neutral-silver-200"},n.authors),l&&n.play_limit>0&&e.createElement("span",{className:"text-xs text-neutral-silver-300"},n.play_limit-n.plays," reproducciones restantes")))))}function F(e){var t,r,n=e.currentTrack;e.audioRef,e.setDuration,e.progressBarRef;var a=e.open;return React.createElement(React.Fragment,null,a?React.createElement("div",null,React.createElement("div",null,React.createElement("div",{className:"flex gap-3 items-center justify-center -mb-2"},React.createElement("div",{className:"w-[286px] h-[286px] bg-cover rounded",style:{backgroundImage:"url(".concat(n.cover_url,")")}})),React.createElement("div",{className:"rounded-3xl px-5 pt-2 backdrop-blur-xl flex flex-col gap-1 items-center justify-center h-[160px]",style:{background:"rgba(67, 71, 79, 0.30)"}},React.createElement("span",{className:"font-thunder-bold text-4xl uppercase !text-center"},n.name),React.createElement("span",{className:"text-neutral-silver-200"},null==n||null===(t=n.authors)||void 0===t?void 0:t.join(", "))))):React.createElement("div",{className:"flex items-center grow min-w-0"},React.createElement("div",{className:"flex gap-3 items-center min-w-0 flex-1"},React.createElement("div",{className:"w-10 h-10 bg-cover rounded min-w-[40px] flex-shrink-0",style:{backgroundImage:"url(".concat(n.cover_url,")")}}),React.createElement("div",{className:"flex flex-col min-w-0 flex-1"},React.createElement("div",{className:"w-full truncate"},React.createElement("span",{className:"text-sm text-white truncate"},n.name)),React.createElement("span",{className:"text-sm text-neutral-silver-200 truncate"},null==n||null===(r=n.authors)||void 0===r?void 0:r.join(", "))))))}function H(){var r,a,o,i,c,u=function(){if("undefined"!=typeof window&&window.__CHEST_PLAYER_DEPS__)return window.__CHEST_PLAYER_DEPS__;throw new Error("ChestPlayer: Dependencies not provided. Make sure to use PlayerProvider.")}(),s=u.apiHooks,p=s.useLazyGetTrackSourceQuery,g=s.useUpdateTrackPlayMutation,h=u.playlistActions,b=h.reset,x=h.play,P=u.playerActions,_=P.closePlayer,R=P.openPlayer,S=u.reduxProps,k=S.dispatch,N=S.playlist;S.playerState;var C=m(e.useState(!1),2);C[0];var O=C[1],j=m(p(),2),A=j[0],H=j[1],I=m(g(),2),B=I[0];I[1];var z=y("PlayLimitModal").onOpen,Y=v("(max-width: 768px)"),q=m(e.useState(!1),2),V=q[0],G=q[1],U=m(e.useState(0),2),Q=U[0],X=U[1],W=m(e.useState(0),2),$=W[0],J=W[1],K=m(e.useState(),2),Z=K[0],ee=K[1],te=m(e.useState(!1),2),re=te[0],ne=te[1],ae=m(e.useState(),2),le=ae[0],oe=ae[1],ie=m(e.useState(0),2),ce=ie[0],ue=ie[1],se=m(e.useState(null),2),fe=se[0],pe=se[1],me=m(e.useState(!1),2);me[0];var de=me[1],ve=m(e.useState(!1),2),ye=ve[0],ge=ve[1],he=m(e.useState(!1),2),Ee=he[0],we=he[1],be=e.useRef(),xe=e.useRef(),Pe=!(null===(r=N[0])||void 0===r||!r.token),_e=m(e.useState(null),2);_e[0],_e[1];var Re=m(e.useState(!1),2);Re[0],Re[1];var Se=m(e.useState(0),2);Se[0];var ke=Se[1],Ne=m(e.useState(!1),2);Ne[0];var Ce=Ne[1],Oe=function(){ne(function(e){return!e})};e.useEffect(function(){k(re?R():_())},[re]),e.useEffect(function(){b()},[]),e.useEffect(function(){var e=Z,t=N&&N[0];if(t){if("object"===d(e)&&e.id===t.id)return;if(O(!1),ue(t.plays||0),pe(t.play_limit||null),we(!1),t.audio)ee({url:t.audio,cover_url:t.cover,name:t.name,authors:t.authors,type:t.type,id:t.id,plays:t.plays,play_limit:t.play_limit});else{var r=localStorage.getItem("chestmusic_session_id");A({id:t.id,session:r}).then(function(e){var r=e.data;r&&ee({url:r.url,cover_url:t.cover,name:t.name,authors:t.authors,type:t.type,id:t.id,plays:t.plays,play_limit:t.play_limit})})}}},[N,H]),e.useEffect(function(){Z?le!==Z.id&&oe(Z.id):oe("")},[Z]),e.useCallback(function(){var e;if(Pe&&null!=Z&&Z.id&&null!==(e=N[0])&&void 0!==e&&e.token){var t="plays_".concat(Z.id,"_").concat(N[0].token),r=localStorage.getItem(t);return r?parseInt(r):0}return 0},[Pe,null==Z?void 0:Z.id,null===(a=N[0])||void 0===a?void 0:a.token]),e.useEffect(function(){var e,t;Pe&&null!=Z&&Z.id&&null!==(e=N[0])&&void 0!==e&&e.token&&(ue(Z.plays||0),(Z.plays||0)>((null===(t=N[0])||void 0===t?void 0:t.play_limit)||0)&&(ge(!0),be.current&&be.current.pause()))},[Pe,null==Z?void 0:Z.id,null===(o=N[0])||void 0===o?void 0:o.token,null==Z?void 0:Z.plays]);var je=function(){if(Pe){var e,t,r=null===(e=N[0])||void 0===e?void 0:e.play_limit;if(r)if(ce>r||ce>=r&&Ee)return null===(t=be.current)||void 0===t||t.pause(),z(),!1}return!0},Ae=function(){var e,t=(e=f().m(function e(){var t,r;return f().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!Pe||ye){e.n=4;break}return e.p=1,e.n=2,B({id:Z.id,anonymous:!0,token:N[0].token});case 2:ue(t=ce+1),t>fe&&(ge(!0),z(),be.current&&be.current.pause()),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Error updating play count:",r);case 4:return e.a(2)}},e,null,[[1,3]])}),function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){l(o,n,a,i,c,"next",e)}function c(e){l(o,n,a,i,c,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}();return e.useEffect(function(){var e;Z&&null!==(e=N[0])&&void 0!==e&&e.isPlaying&&(je()||k(x()))},[Z,null===(i=N[0])||void 0===i?void 0:i.isPlaying]),e.useEffect(function(){var e;(null===(e=N[0])||void 0===e?void 0:e.id)!==le&&(de(!1),Ce(!1),ke(0),we(!1))},[null===(c=N[0])||void 0===c?void 0:c.id]),e.createElement(e.Fragment,null,Z&&N.length>0&&e.createElement(e.Fragment,null,e.createElement("audio",{src:Z.url,ref:be,onLoadedMetadata:function(){var e=be.current.duration;J(e),xe.current.max=e},onEnded:function(){de(!0),Ce(!1),ke(0),we(!1)},onTimeUpdate:function(){if(be.current){var e=be.current.currentTime;e>.15*$&&Ce(!0),ke(e),X(e)}},onPlay:function(){var e,t;je()?((null===(e=be.current)||void 0===e?void 0:e.currentTime)||0)<.15*$&&!Ee&&(Ce(!1),Ae(),we(!0)):null===(t=be.current)||void 0===t||t.pause()}}),Pe&&null!==fe&&fe>0&&e.createElement("div",{className:"fixed bottom-[102px] right-0 left-0 inset-x-0 max-w-max mx-auto z-50"},e.createElement(t.motion.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},className:"px-6 py-3 bg-neutral-silver-600 rounded-t-xl"},e.createElement("span",{className:"text-brand-gold"},Math.max(0,fe-ce))," of ",fe," plays remaining")),Y?e.createElement(e.Fragment,null,e.createElement("div",{className:"".concat(re?"audio-player-mobile-open":"audio-player-mobile")},re?e.createElement("div",{className:"bg-neutral-silver-700 rounded-3xl mb-3 gap-5 flex flex-col"},e.createElement("div",{className:"px-2 pt-2 flex flex-row justify-between"},e.createElement("button",{type:"button",className:"p-2.5",onClick:Oe},e.createElement(n.ChevronDownIcon,{className:"h-6 w-6 text-white"}))),e.createElement(F,{currentTrack:Z,audioRef:be,setDuration:J,progressBarRef:xe,open:re,dispatch:k,playlist:N})):e.createElement("div",{className:"flex flex-row min-w-0 w-full",onClick:Oe},e.createElement(F,{currentTrack:Z,audioRef:be,setDuration:J,progressBarRef:xe,dispatch:k,playlist:N}),e.createElement(M,{audioRef:be,progressBarRef:xe,duration:$,setTimeProgress:X,setLoop:G,loop:V,dispatch:k,playlist:N})),e.createElement("div",{className:"".concat(re&&"bg-neutral-silver-600 px-5 pb-5 pt-4 rounded-3xl flex flex-col gap-1.5")},e.createElement("div",{className:"".concat(re&&"flex items-center justify-center gap-1.5")},re&&e.createElement(T,{audioRef:be,progressBarRef:xe,duration:$,setTimeProgress:X,setLoop:G,loop:V})),e.createElement(w,{progressBarRef:xe,audioRef:be,timeProgress:Q,duration:$,open:re,playlist:N}))),re&&e.createElement("div",{className:"absolute top-0 left-0 w-screen h-screen bg-neutral-black"})):e.createElement(t.motion.div,{className:"audio-player",initial:{height:0},animate:{height:"auto"},exit:{height:0,transition:{delay:.7,duration:1,ease:"easeIn"}}},e.createElement(D,{currentTrack:Z,audioRef:be,setDuration:J,progressBarRef:xe,dispatch:k,playlist:N}),e.createElement("div",{className:"grow flex flex-col items-center justify-center gap-1.5"},e.createElement(T,{audioRef:be,progressBarRef:xe,duration:$,setTimeProgress:X,setLoop:G,loop:V,dispatch:k,playlist:N}),e.createElement(E,{progressBarRef:xe,audioRef:be,timeProgress:Q,duration:$,playlist:N})),e.createElement(L,{audioRef:be,dispatch:k}))))}var I=["apiHooks","playlistActions","playerActions","reduxProps"];exports.Controls=T,exports.ControlsMobile=M,exports.Player=H,exports.PlayerProvider=function(t){var r=t.apiHooks,n=t.playlistActions,a=t.playerActions,l=t.reduxProps,o=s(t,I);return"undefined"!=typeof window&&(window.__CHEST_PLAYER_DEPS__={apiHooks:r,playlistActions:n,playerActions:a,reduxProps:l}),e.createElement(H,o)},exports.ProgressBar=E,exports.ProgressBarMobile=w,exports.Track=D,exports.TrackMobile=F,exports.VolumeControls=L,exports.useMediaQuery=v,exports.useModal=y;
//# sourceMappingURL=index.js.map
